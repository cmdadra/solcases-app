<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolCases.fun - Premium Solana Pack Opening</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Skranji:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #1a1b23;
            --bg-secondary: #232530;
            --bg-card: #2a2d3a;
            --accent-primary: #ffd700;
            --accent-secondary: #ffb347;
            --accent-tertiary: #ffa500;
            --accent-gold: #ffcc00;
            --accent-bright: #ffff00;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --border: #374151;
            --shadow: 0 8px 32px rgba(255, 215, 0, 0.25);
        }

        body {
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.12) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(255, 179, 71, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(255, 165, 0, 0.06) 0%, transparent 60%),
                radial-gradient(circle at 60% 60%, rgba(255, 215, 0, 0.04) 0%, transparent 60%),
                radial-gradient(circle at 10% 10%, rgba(255, 179, 71, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, rgba(26, 27, 35, 0.95) 0%, rgba(35, 37, 48, 0.95) 50%, rgba(42, 45, 58, 0.95) 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }

        .main {
            position: relative;
        }

        .main::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255, 215, 0, 0.03) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(255, 179, 71, 0.025) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(255, 165, 0, 0.02) 1px, transparent 1px);
            background-size: 60px 60px, 80px 80px, 100px 100px;
            background-position: 0 0, 40px 40px, 50px 50px;
            pointer-events: none;
            z-index: -1;
            transition: all 0.3s ease;
        }

        /* Interactive dot hover effects */
        .main:hover::before {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255, 215, 0, 0.06) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(255, 179, 71, 0.05) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(255, 165, 0, 0.04) 1px, transparent 1px);
            transform: scale(1.02);
        }

        /* Add subtle animated background elements */
        .main::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(255, 215, 0, 0.06) 0%, transparent 70%),
                radial-gradient(ellipse at 80% 20%, rgba(255, 179, 71, 0.04) 0%, transparent 70%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 165, 0, 0.03) 0%, transparent 60%);
            animation: backgroundFloat 15s ease-in-out infinite;
            pointer-events: none;
            z-index: -2;
        }

        @keyframes backgroundFloat {
            0%, 100% {
                transform: translateY(0px) scale(1);
            }
            50% {
                transform: translateY(-10px) scale(1.05);
            }
        }

        /* Pack Opening Animations */
        @keyframes fadeIn {
            from {
                background: rgba(0, 0, 0, 0);
            }
            to {
                background: rgba(0, 0, 0, 0.8);
            }
        }

        @keyframes slideInScale {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes glowPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(251, 191, 36, 0.6);
            }
        }

        /* SolCases Title Effects */
        @keyframes neonGlow {
            0%, 100% {
                text-shadow: 
                    0 0 3px rgba(255, 215, 0, 0.6),
                    0 0 6px rgba(255, 179, 71, 0.4),
                    0 0 9px rgba(255, 165, 0, 0.3);
            }
            50% {
                text-shadow: 
                    0 0 5px rgba(255, 215, 0, 0.8),
                    0 0 10px rgba(255, 179, 71, 0.6),
                    0 0 15px rgba(255, 165, 0, 0.4);
            }
        }

        @keyframes titleShimmer {
            0% {
                background-position: -200% center;
            }
            100% {
                background-position: 200% center;
            }
        }

        @keyframes titleFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-3px);
            }
        }

        /* Interactive dot animations */
        @keyframes dotHover {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.03;
            }
            50% {
                transform: translate(5px, -5px) scale(1.5);
                opacity: 0.08;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.03;
            }
        }

        @keyframes dotHover2 {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.025;
            }
            50% {
                transform: translate(-3px, 3px) scale(1.3);
                opacity: 0.06;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.025;
            }
        }

        @keyframes dotHover3 {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.02;
            }
            50% {
                transform: translate(4px, 4px) scale(1.4);
                opacity: 0.05;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.02;
            }
        }



        /* Tooltip Animations */
        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes tooltipSlideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Rarity Glow Animations */
        @keyframes commonGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(139, 157, 195, 0.6), 0 0 16px rgba(139, 157, 195, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(139, 157, 195, 0.9), 0 0 30px rgba(139, 157, 195, 0.7), 0 0 40px rgba(139, 157, 195, 0.5);
            }
        }

        @keyframes uncommonGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(62, 184, 50, 0.6), 0 0 16px rgba(62, 184, 50, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(62, 184, 50, 0.9), 0 0 30px rgba(62, 184, 50, 0.7), 0 0 40px rgba(62, 184, 50, 0.5);
            }
        }

        @keyframes rareGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(0, 112, 221, 0.6), 0 0 16px rgba(0, 112, 221, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(0, 112, 221, 0.9), 0 0 30px rgba(0, 112, 221, 0.7), 0 0 40px rgba(0, 112, 221, 0.5);
            }
        }

        @keyframes epicGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(163, 53, 238, 0.6), 0 0 16px rgba(163, 53, 238, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(163, 53, 238, 0.9), 0 0 30px rgba(163, 53, 238, 0.7), 0 0 40px rgba(163, 53, 238, 0.5);
            }
        }

        @keyframes legendaryGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(255, 128, 0, 0.6), 0 0 16px rgba(255, 128, 0, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(255, 128, 0, 0.9), 0 0 30px rgba(255, 128, 0, 0.7), 0 0 40px rgba(255, 128, 0, 0.5);
            }
        }

        @keyframes mythicGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(236, 72, 153, 0.6), 0 0 16px rgba(236, 72, 153, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(236, 72, 153, 0.9), 0 0 30px rgba(236, 72, 153, 0.7), 0 0 40px rgba(236, 72, 153, 0.5);
            }
        }

        @keyframes divineGlow {
            0%, 100% {
                text-shadow: 0 0 8px rgba(251, 191, 36, 0.6), 0 0 16px rgba(251, 191, 36, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(251, 191, 36, 0.9), 0 0 30px rgba(251, 191, 36, 0.7), 0 0 40px rgba(251, 191, 36, 0.5);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Skranji', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            padding: 8px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            gap: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-primary);
            letter-spacing: 1px;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-btn {
            background: transparent;
            border: none;
            padding: 8px 12px;
            color: #888;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-family: 'Skranji', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-transform: none;
            letter-spacing: 0.2px;
            margin-right: 8px;
            position: relative;
        }

        .nav-btn.active {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-primary);
            border-radius: 1px;
        }

        .nav-btn:hover:not(.active) {
            color: #aaa;
        }

        .nav-btn:hover.active {
            color: var(--accent-secondary);
        }

        .wallet-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header {
            position: relative;
        }

        .level-info {
            position: absolute;
            left: 42%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }

        .wallet-btn {
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            color: #0d1421;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-family: 'Skranji', sans-serif;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .wallet-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .deposit-btn {
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            color: #0d1421;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-family: 'Skranji', sans-serif;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
            margin-left: 6px;
        }

        .deposit-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.5);
        }

        .withdraw-btn {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-family: 'Skranji', sans-serif;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-left: 6px;
        }

        .withdraw-btn:hover {
            transform: translateY(-2px) scale(1.02);
        }



        .wallet-info {
            background: var(--bg-card);
            padding: 8px 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .balance {
            font-weight: 600;
            color: var(--accent-gold);
            font-size: 14px;
        }

        .level-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            margin-bottom: 0;
        }

        .level-badge {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: var(--bg-primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 2px;
            box-shadow: 0 1px 4px rgba(0, 212, 255, 0.3);
        }

        .level-badge::before {
            content: "⭐";
            font-size: 10px;
        }

        .xp-progress {
            width: 40px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff 0%, #0099cc 100%);
            transition: width 0.3s ease;
        }

        .xp-text {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
        }



        .address {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Main Content */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .hero {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero h1 {
            font-size: 52px;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(90deg, 
                #e6c200 0%, 
                #e6a800 25%, 
                #cc8c00 50%, 
                #e6a800 75%, 
                #e6c200 100%);
            background-size: 200% 100%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
            animation: 
                neonGlow 3s ease-in-out infinite,
                titleFloat 4s ease-in-out infinite,
                titleShimmer 6s linear infinite;
            position: relative;
            z-index: 1;
        }
        
        @keyframes glow {
            0% { text-shadow: 0 0 30px rgba(251, 191, 36, 0.5); }
            100% { text-shadow: 0 0 40px rgba(251, 191, 36, 0.8); }
        }

        .hero h1::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(230, 194, 0, 0.05) 0%, 
                rgba(230, 168, 0, 0.05) 25%, 
                rgba(204, 140, 0, 0.05) 50%, 
                rgba(230, 168, 0, 0.05) 75%, 
                rgba(230, 194, 0, 0.05) 100%);
            filter: blur(15px);
            z-index: -1;
            animation: neonGlow 3s ease-in-out infinite;
        }

        .hero p {
            font-size: 20px;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Packs Grid */
        .packs-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-bottom: 60px;
            width: 100%;
        }

        .pack-card {
            background: 
                linear-gradient(135deg, rgba(42, 45, 58, 0.9) 0%, rgba(35, 37, 48, 0.9) 100%),
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(255, 179, 71, 0.03) 0%, transparent 60%);
            backdrop-filter: blur(8px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-weight: 500;
            width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            height: 520px;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.2),
                0 0 40px rgba(255, 179, 71, 0.1),
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        }

        .pack-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.015) 1px, transparent 1px);
            background-size: 40px 40px, 60px 60px;
            background-position: 0 0, 20px 20px;
            pointer-events: none;
            z-index: 1;
        }

        .pack-card:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.4),
                0 0 60px rgba(255, 179, 71, 0.2),
                0 0 90px rgba(255, 165, 0, 0.1),
                0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .pack-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        }



        .pack-card-result {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .pack-card-result:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        .pack-icon {
            font-size: 64px;
            margin-bottom: 15px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pack-icon img {
            width: 135%;
            height: 135%;
            object-fit: contain;
            margin-bottom: 15px;
        }

        /* Make Pro Pack image bigger to match others */
        .pack-card:nth-child(2) .pack-icon img {
            width: 135%;
            height: 135%;
            transform: scale(1.15);
        }

        .pack-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .pack-price {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent-primary);
            margin-bottom: 20px;
        }

        .pack-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .odds-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 25px;
        }

        .odd-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-primary);
            border-radius: 8px;
            font-size: 14px;
        }

        .rarity {
            font-weight: 600;
        }

        .rarity.common { 
            color: #8b9dc3; 
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .rarity.uncommon { 
            color: #3eb832; 
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .rarity.rare { 
            color: #0070dd; 
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .rarity.epic { 
            color: #a335ee; 
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .rarity.legendary { 
            color: #ff8000; 
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .rarity.mythic { 
            color: #ec4899; 
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .rarity.divine { 
            color: #fbbf24; 
            transition: all 0.3s ease;
            font-weight: 600;
        }

        /* Rarity hover effects with animated glows */
        .tooltip-odds-header:hover .rarity.common {
            animation: commonGlow 1.5s ease-in-out infinite;
        }

        .tooltip-odds-header:hover .rarity.uncommon {
            animation: uncommonGlow 1.5s ease-in-out infinite;
        }

        .tooltip-odds-header:hover .rarity.rare {
            animation: rareGlow 1.5s ease-in-out infinite;
        }

        .tooltip-odds-header:hover .rarity.epic {
            animation: epicGlow 1.5s ease-in-out infinite;
        }

        .tooltip-odds-header:hover .rarity.legendary {
            animation: legendaryGlow 1.5s ease-in-out infinite;
        }

        .tooltip-odds-header:hover .rarity.mythic {
            animation: mythicGlow 1.5s ease-in-out infinite;
        }

        .tooltip-odds-header:hover .rarity.divine {
            animation: divineGlow 1.5s ease-in-out infinite;
        }

        .open-btn {
            width: 100%;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-tertiary));
            border: 3px solid transparent;
            padding: 18px;
            border-radius: 16px;
            color: #0d1421;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Skranji', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pack-info-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            background: var(--accent-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            color: #0d1421;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .pack-info-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }

        .tooltip {
            position: absolute;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 300px;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px) scale(0.95);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .tooltip.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
            animation: tooltipFadeIn 0.4s ease-out;
        }

        .tooltip-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent-gold);
        }

        .tooltip-odds {
            margin-bottom: 15px;
        }

        .tooltip-odds-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .tooltip-cards {
            border-top: 1px solid var(--border);
            padding-top: 10px;
        }

        .tooltip-cards-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .tooltip-cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .tooltip-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .tooltip-card:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-primary);
        }

        .tooltip-card-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .tooltip-card-name {
            font-size: 10px;
            color: var(--text-secondary);
            line-height: 1.2;
        }

        .tooltip-odds-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 8px 0;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 2px 0;
        }

        .rarity-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .rarity-percentage {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .tooltip-odds-header:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px 6px;
            margin: 0 -6px;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        .expand-icon {
            font-size: 10px;
            transition: transform 0.2s ease;
        }
        .tooltip-odds-header.expanded .expand-icon {
            transform: rotate(180deg);
        }
        .tooltip-rarity-cards {
            margin-top: 8px;
            padding-left: 12px;
            border-left: 2px solid rgba(255, 255, 255, 0.2);
        }
        .tooltip-rarity-cards.hidden {
            display: none;
        }

        .tooltip {
            pointer-events: none;
        }
        .tooltip.cards-mode {
            pointer-events: auto;
        }

        .open-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
            border-color: var(--accent-secondary);
        }

        .open-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Header Stats */
        .header-stats {
            display: flex;
            align-items: center;
            gap: 40px;
            justify-self: center;
            grid-column: 2;
            justify-content: center;
            width: 100%;
            margin-left: -50px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-primary);
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 2px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 15px;
            }

            .header-stats {
                gap: 30px;
            }

            .stat-value {
                font-size: 18px;
            }

            .stat-label {
                font-size: 11px;
            }

            .main {
                padding: 20px;
            }

            .hero h1 {
                font-size: 36px;
            }

            .packs-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden elements */
        .hidden {
            display: none;
        }

        /* Chat Sidebar */
        .chat-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 300px;
            height: 100vh;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(255, 179, 71, 0.06) 0%, transparent 60%),
                linear-gradient(135deg, rgba(35, 37, 48, 0.95) 0%, rgba(42, 45, 58, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-right: 2px solid rgba(255, 215, 0, 0.15);
            display: flex;
            flex-direction: column;
            z-index: 50;
            box-shadow: 
                5px 0 20px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(255, 215, 0, 0.1);
        }

        .chat-header {
            padding: 20px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .chat-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .chat-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .chat-online-status {
            padding: 8px 20px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-stats {
            display: flex;
            gap: 15px;
            margin-left: auto;
        }

        .chat-stat-item {
            text-align: center;
        }

        .chat-stat-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .chat-stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .username-section {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-primary);
            display: flex;
            gap: 8px;
        }

        .username-input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .username-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .username-btn {
            background: var(--accent-primary);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: #0d1421;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .username-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        .online-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 6px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .message-username {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .message-level {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 8px;
        }

        .message-time {
            color: var(--text-secondary);
        }

        .message-content {
            background: var(--bg-card);
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message-content.own {
            background: var(--accent-primary);
            color: #0d1421;
            align-self: flex-end;
            max-width: 80%;
        }

        .message-content.system {
            background: var(--bg-primary);
            border-color: var(--accent-secondary);
            font-style: italic;
            color: var(--accent-secondary);
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: var(--bg-card);
        }

        .chat-input {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            resize: none;
            min-height: 20px;
            max-height: 100px;
        }

        .chat-input:focus {
            border-color: var(--accent-primary);
        }

        .chat-input::placeholder {
            color: var(--text-secondary);
        }

        .chat-send-btn {
            margin-top: 8px;
            width: 100%;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            padding: 10px;
            border-radius: 8px;
            color: #0d1421;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .chat-send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
        }

        .chat-send-btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Adjust main content for chat */
        .main {
            margin-left: 300px;
        }

        .header {
            margin-left: 300px;
        }

        /* Chat toggle for mobile */
        .chat-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--accent-primary);
            color: #0d1421;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 60;
            font-size: 16px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .chat-sidebar {
                width: 250px;
            }

            .main {
                margin-left: 250px;
            }

            .header {
                margin-left: 250px;
            }

            .chat-toggle {
                display: none;
            }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(251, 191, 36, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 0 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .modal-header h3 {
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 0 24px 24px 24px;
        }

        .deposit-section {
            margin-bottom: 24px;
        }

        .input-label {
            display: block;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .token-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .token-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .token-option.selected {
            border-color: var(--accent-primary);
            background: rgba(251, 191, 36, 0.1);
        }

        .token-icon {
            font-size: 20px;
            color: var(--accent-primary);
        }

        .token-name {
            color: var(--text-primary);
        }

        .amount-input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .amount-input {
            width: 100%;
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            font-family: 'Skranji', sans-serif;
            outline: none;
            transition: all 0.2s ease;
        }

        .amount-input:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.2);
        }

        .balance-info {
            margin-top: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .amount-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .amount-btn {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-family: 'Skranji', sans-serif;
        }

        .amount-btn:hover {
            border-color: var(--accent-gold);
            background: rgba(255, 215, 0, 0.15);
        }

        .deposit-info {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .deposit-info p {
            margin: 0;
            color: var(--text-primary);
            font-size: 14px;
        }

        .promo-section {
            margin-bottom: 24px;
        }

        .promo-section p {
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .promo-link {
            color: var(--accent-primary);
            cursor: pointer;
            text-decoration: underline;
        }

        .promo-input {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .promo-code-input {
            flex: 1;
            padding: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Skranji', sans-serif;
            outline: none;
        }

        .promo-code-input:focus {
            border-color: var(--accent-gold);
        }

        .apply-promo-btn {
            padding: 12px 20px;
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Skranji', sans-serif;
        }

        .deposit-confirm-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 12px;
            color: var(--bg-primary);
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Skranji', sans-serif;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }

        .deposit-confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }

        .address-container {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .deposit-address {
            background: var(--bg-primary);
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            flex: 1;
            word-break: break-all;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
        }

        .copy-btn {
            background: var(--accent-primary);
            border: none;
            border-radius: 12px;
            padding: 16px 20px;
            color: #0d1421;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-family: 'Skranji', sans-serif;
        }

        .copy-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }

        .copy-btn.copied {
            background: #10b981;
            color: white;
        }

        .warning-text {
            color: #fbbf24;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .success-text {
            color: #10b981;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .balance-info {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 0;
        }

        .transaction-status {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            border: 1px solid var(--accent-primary);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            gap: 16px;
            animation: pulse 2s infinite;
        }

        .status-icon {
            font-size: 24px;
            animation: spin 2s linear infinite;
        }

        .status-title {
            color: var(--text-primary);
            font-weight: 600;
            margin: 0 0 4px 0;
            font-size: 16px;
        }

        .status-subtitle {
            color: var(--text-secondary);
            margin: 0;
            font-size: 14px;
        }

        .processing-note {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 8px;
        }

        /* Withdraw Modal Styles */
        .withdraw-section {
            margin-bottom: 24px;
        }

        .balance-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .balance-currency {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .amount-input-container {
            position: relative;
            margin-bottom: 12px;
        }

        .amount-input {
            width: 100%;
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            font-family: 'Skranji', sans-serif;
            transition: all 0.2s ease;
        }

        .amount-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }

        .currency-label {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 16px;
        }

        .amount-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .amount-btn {
            flex: 1;
            padding: 12px 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Skranji', sans-serif;
        }

        .amount-btn:hover {
            background: var(--accent-primary);
            color: #0d1421;
            border-color: var(--accent-primary);
        }

        .address-display {
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
            margin-bottom: 16px;
        }

        .address-input-container {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }

        .address-input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s;
        }

        .address-input:focus {
            border-color: var(--accent-primary);
        }

        .paste-btn {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        .paste-btn:hover {
            background: var(--accent-secondary);
        }

        .address-note {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 4px;
            opacity: 0.8;
        }

        .withdraw-actions {
            margin-top: 24px;
        }

        .withdraw-confirm-btn {
            width: 100%;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            padding: 18px;
            border-radius: 16px;
            color: #0d1421;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Skranji', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .withdraw-confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }

        .withdraw-confirm-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* Card Flipping Animations */
        @keyframes cardFlip {
            0% {
                transform: rotateY(0deg);
            }
            100% {
                transform: rotateY(180deg);
            }
        }

        @keyframes cardFlipBack {
            0% {
                transform: rotateY(180deg);
            }
            100% {
                transform: rotateY(0deg);
            }
        }

        /* Rare Card Animations */
        @keyframes rareCardReveal {
            0% {
                transform: scale(0.3) rotate(180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(90deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes rarityBadge {
            0% {
                transform: scale(0) rotate(-10deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes epicMultiplier {
            0% {
                transform: scale(0.5) translateY(20px);
                opacity: 0;
                text-shadow: 0 0 0px var(--accent-primary);
            }
            50% {
                transform: scale(1.3) translateY(-5px);
                text-shadow: 0 0 20px var(--accent-primary);
            }
            100% {
                transform: scale(1.1) translateY(0);
                opacity: 1;
                text-shadow: 0 0 10px var(--accent-primary);
            }
        }

        @keyframes epicGlow {
            0%, 100% {
                text-shadow: 0 0 10px var(--accent-primary);
                filter: brightness(1);
            }
            50% {
                text-shadow: 0 0 25px var(--accent-primary), 0 0 35px var(--accent-primary);
                filter: brightness(1.2);
            }
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pack-card-result {
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .pack-card-result:hover {
            transform: scale(1.05);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .card-front {
            background: linear-gradient(135deg, #2a2d3a, #1a1b23);
            border: 2px solid #374151;
            background-image: 
                radial-gradient(circle at 30% 30%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(251, 191, 36, 0.1) 0%, transparent 50%);
        }

        .card-back {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            transform: rotateY(180deg);
        }

        .card-inner.flipped {
            transform: rotateY(180deg);
        }

        .card-back-icon {
            font-size: 48px;
            margin-bottom: 12px;
            color: var(--accent-primary);
        }

        .card-back-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Inventory Section */
        .inventory-section {
            margin-top: 60px;
            width: 100%;
        }

        .inventory-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .inventory-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .inventory-subtitle {
            color: var(--text-secondary);
            font-size: 18px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .inventory-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .inventory-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow);
        }

        .inventory-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .card-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .card-rarity {
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .card-count {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .empty-inventory {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }



        .empty-inventory-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-inventory-text {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .empty-inventory-subtext {
            font-size: 14px;
        }

        /* Rarity colors for inventory cards */
        .card-rarity.common { color: #8b9dc3; }
        .card-rarity.uncommon { color: #3eb832; }
        .card-rarity.rare { color: #0070dd; }
        .card-rarity.epic { color: #a335ee; }
        .card-rarity.legendary { color: #ff8000; }
        .card-rarity.mythic { color: #ff6b6b; }
        .card-rarity.divine { color: #fbbf24; }

        /* Balance notification */
        .balance-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .balance-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .balance-notification.error {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .balance-notification.success {
            border-color: #00ff88;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
            text-shadow: 0 0 5px rgba(0, 255, 136, 0.5);
        }



        /* Recent Wins Display - CS:GO Style */
        .recent-wins {
            display: none; /* Hide recent wins notifications */
        }

        .win-notification {
            display: none; /* Hide win notifications */
        }

        .win-header {
            display: none; /* Hide win headers */
        }

        .win-username {
            display: none; /* Hide usernames */
        }

        .win-amount {
            display: none; /* Hide amounts */
        }

        @keyframes winSlideIn {
            /* Remove animation */
        }

        @keyframes winFadeOut {
            /* Remove animation */
        }

        /* Real-time Stats Animation - CS:GO Style */
        .stat-value {
            transition: all 0.3s ease;
            position: relative;
        }

        .stat-value.updating {
            animation: statPulse 0.8s ease-in-out;
        }

        @keyframes statPulse {
            0% { 
                transform: scale(1); 
                color: #ffffff;
            }
            50% { 
                transform: scale(1.15); 
                color: #00ff88;
                text-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
            }
            100% { 
                transform: scale(1); 
                color: #ffffff;
            }
        }

        /* Obsidian Pack Card Animations */
        @keyframes cardSlideIn {
            0% {
                transform: translateY(50px) scale(0.8);
                opacity: 0;
            }
            50% {
                transform: translateY(-10px) scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes cardFloat {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }

        /* Adjust main content for ticker */
        main {
            margin-left: 300px;
        }

        .header {
            margin-left: 300px;
        }

        /* Mobile responsive adjustments - CS:GO Style */
        @media (max-width: 768px) {
            /* Recent wins removed */
        }

        /* Provably Fair Section */
        .provably-fair-section {
            margin-top: 60px;
            padding: 40px;
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        .provably-fair-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .provably-fair-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .provably-fair-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .fair-info-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .fair-info-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .fair-icon {
            font-size: 24px;
            color: var(--accent-primary);
        }

        .fair-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .fair-hash {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .fair-description {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .fair-verification-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .verification-details {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .verify-btn {
            width: 100%;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            color: #0d1421;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
        }


    </style>
</head>
<body>
    <!-- Chat Toggle (Mobile) -->
    <button class="chat-toggle" onclick="toggleChat()">💬</button>

    <!-- Chat Sidebar -->
    <div class="chat-sidebar" id="chatSidebar">
                                    <div class="chat-header">
            <div class="chat-title" style="font-size: 20px; position: relative;">
              <img src="https://media.discordapp.net/attachments/1401256951244918905/1404437800626946109/raw.png?ex=689b3020&is=6899dea0&hm=f895ad548c18d9b5d7c0cb82489d127d6f90fa706a648c47f6fb1203a1564d42&=&format=webp&quality=lossless" alt="logo" style="height: 60px; width: 60px; object-fit: contain; position: absolute; left: -10px; top: -15px; z-index: 10;">
              <span style="color: white; font-weight: bold; margin-left: 45px;">SolCases.fun</span>
        </div>
        </div>
        <div class="chat-online-status">
            <span class="online-dot"></span>
            <span id="chatOnlineCount">1</span> online
            <div class="chat-stats">
                <div class="chat-stat-item">
                    <div class="chat-stat-value" id="packsOpened">0</div>
                    <div class="chat-stat-label">Packs Opened</div>
                </div>
                <div class="chat-stat-item">
                    <div class="chat-stat-value" id="totalWon">0</div>
                    <div class="chat-stat-label">SOL Won</div>
                </div>
            </div>
        </div>
        
        <!-- Username Input -->
        <div class="username-section" id="usernameSection">
            <input type="text" class="username-input" id="usernameInput" placeholder="Enter your username..." maxlength="20">
            <button class="username-btn" onclick="setUsername()">Set Name</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be added here -->
        </div>
        
        <div class="chat-input-container">
            <textarea class="chat-input" id="chatInput" placeholder="Type a message..." rows="1"></textarea>
            <button class="chat-send-btn" id="chatSendBtn" onclick="sendMessage()">Send Message</button>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo-section">
                <div class="logo"></div>
                               <div class="header-buttons">
                   <button class="nav-btn active" onclick="showPacks()">Packs</button>
                   <button class="nav-btn" onclick="showInventory()">Inventory</button>
                   <button class="nav-btn" onclick="window.location.href='collections.html'">Collections</button>
                   <button class="nav-btn" onclick="window.location.href='provably-fair.html'">Provably Fair</button>
                   <button class="nav-btn" onclick="showAffiliate()">Affiliate</button>
               </div>
            </div>
            
            <div class="wallet-section">
                <button class="wallet-btn" id="connectBtn" onclick="connectWallet()">
                    Connect Wallet
                </button>
                <div class="wallet-info hidden" id="walletInfo">
                                       <div class="balance" id="balance">0.0000 SOL</div>
                   <div class="address" id="address">Not connected</div>
                   <button class="withdraw-btn" onclick="requestWithdraw()" id="withdrawBtn" style="display: none;">
                       Withdraw
                   </button>
                   <button class="deposit-btn" onclick="showDepositModal()" id="depositBtn" style="display: none;">
                       Deposit
                   </button>
                </div>
            </div>
        </nav>
        
        <!-- Level bar positioned on the header -->
        <div class="level-info" id="levelInfo" style="display: none;">
            <div class="level-badge" id="levelBadge">Level 1</div>
            <div class="xp-progress">
                <div class="xp-fill" id="xpFill" style="width: 0%"></div>
            </div>
            <div class="xp-text" id="xpText">0/100</div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Hero Section -->
        <section class="hero">
            <h1>SolCases</h1>
            <p>Open packs, collect cards, cash out SOL. Simple as that.</p>
        </section>

        <!-- Packs Grid -->
        <section class="packs-grid">
            <!-- Silver Pack -->
            <div class="pack-card">
                                <div class="pack-info-icon" onmouseover="showPackTooltip(event, 'starter')" onmouseout="hideTooltip()" onclick="toggleCardsMode('starter')">i</div>
                <div class="pack-icon">
                    <img src="https://media.discordapp.net/attachments/1404212130269630504/1404225616328527983/Projekt_bez_nazwy_3.png?ex=689db644&amp;is=689c64c4&amp;hm=2275dadd5c9b752df0925dcc7fcb816900857069fcd38cc44d2726d40057c8b4&amp;=&amp;format=webp&amp;quality=lossless" alt="Silver Pack" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span style="display: none; font-size: 120px;">📦</span>
                </div>
                <div class="pack-name">Silver Pack</div>
                <div class="pack-price">0.001 SOL</div>
                <div class="pack-description">Perfect for beginners. Low risk, steady rewards.</div>
                <button class="open-btn" onclick="openPack('starter')">Open Silver Pack</button>
            </div>

            <!-- Gold Pack -->
            <div class="pack-card">
                                <div class="pack-info-icon" onmouseover="showPackTooltip(event, 'pro')" onmouseout="hideTooltip()" onclick="toggleCardsMode('pro')">i</div>
                <div class="pack-icon">
                    <img src="https://media.discordapp.net/attachments/1404212130269630504/1404225941126906026/Projekt_bez_nazwy_5.png?ex=689db691&amp;is=689c6511&amp;hm=fc9c863ad81a8feca3dc023209a5390962601150053272ab5d848fbbc0fd5d27&amp;=&amp;format=webp&amp;quality=lossless" alt="Gold Pack" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span style="display: none; font-size: 120px;">🎁</span>
                </div>
                <div class="pack-name">Gold Pack</div>
                <div class="pack-price">0.01 SOL</div>
                <div class="pack-description">For experienced players. Higher stakes, better odds.</div>
                <button class="open-btn" onclick="openPack('pro')">Open Gold Pack</button>
            </div>

            <!-- Diamond Pack -->
            <div class="pack-card">
                                <div class="pack-info-icon" onmouseover="showPackTooltip(event, 'elite')" onmouseout="hideTooltip()" onclick="toggleCardsMode('elite')">i</div>
                <div class="pack-icon">
                    <img src="https://media.discordapp.net/attachments/1404212130269630504/1404226342454820954/Projekt_bez_nazwy_7.png?ex=689db6f1&amp;is=689c6571&amp;hm=2eaa0641c20f87d0cb36bb52fe5a3edc3290114563cb1c836019fef5e3cfdc45&amp;=&amp;format=webp&amp;quality=lossless&amp;width=233&amp;height=350" alt="Diamond Pack" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span style="display: none; font-size: 120px;">💎</span>
                </div>
                <div class="pack-name" style="text-align: center;">Diamond Pack</div>
                <div class="pack-price" style="text-align: center;">0.1 SOL</div>
                <div class="pack-description" style="text-align: center;">High roller exclusive. Premium cards.</div>
                <button class="open-btn" onclick="openPack('elite')">Open Diamond Pack</button>
            </div>

            <!-- Obsidian Pack -->
            <div class="pack-card">
                                <div class="pack-info-icon" onmouseover="showPackTooltip(event, 'whale')" onmouseout="hideTooltip()" onclick="toggleCardsMode('whale')">i</div>
                <div class="pack-icon">
                    <img src="https://media.discordapp.net/attachments/1404212130269630504/1404238941980200990/9be4f6f9-70d8-4607-9605-c368ff19d72a.png?ex=689dc2ad&amp;is=689c712d&amp;hm=4d7363f1ea402ba0f75e35fe04e35b54ebc45ca66b76e9b52a952fcb98c65f41&amp;=&amp;format=webp&amp;quality=lossless&amp;width=670&amp;height=1006" alt="Obsidian Pack" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <span style="display: none; font-size: 120px;">🐋</span>
                </div>
                <div class="pack-name">Obsidian Pack</div>
                <div class="pack-price">1.0 SOL</div>
                <div class="pack-description">For the ultimate degen. Guaranteed epic+ cards.</div>
                <button class="open-btn" onclick="openPack('whale')">Open Obsidian Pack</button>
                    </div>
        </section>

        <!-- Inventory Section -->
        <section class="inventory-section">
            <div class="inventory-header">
                <h2 class="inventory-title">My Inventory</h2>
                <p class="inventory-subtitle">View your collected cards and their rarities.</p>
                    </div>
            <div class="inventory-grid" id="inventoryGrid">
                <!-- Inventory items will be added here -->
                    </div>
            <div class="empty-inventory" id="emptyInventory" style="display: none;">
                <div class="empty-inventory-icon">🎁</div>
                <div class="empty-inventory-text">Your inventory is empty!</div>
                <div class="empty-inventory-subtext">Open packs to start collecting cards!</div>
            </div>
        </section>




    </main>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <!-- Balance Notification -->
    <div class="balance-notification" id="balanceNotification"></div>

    <!-- Recent Wins Display -->
            <!-- Recent wins removed -->





    <!-- Deposit Modal -->
    <div class="modal-overlay" id="depositModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💰 Deposit</h3>
                <button class="close-btn" onclick="closeDepositModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="deposit-section">
                    <label class="input-label">Tokens</label>
                    <div class="token-selector">
                        <div class="token-option selected" data-token="sol">
                            <span class="token-icon">◎</span>
                            <span class="token-name">SOL</span>
                        </div>
                    </div>
                </div>
                
                <div class="deposit-section">
                    <label class="input-label">Send SOL to this address:</label>
                    <div class="address-container">
                        <div class="deposit-address" id="depositAddress">
                            7h4RA4PoiVhVQ41tZgXZrFmPXrrATDxFKrFTnENJx643
                        </div>
                        <button class="copy-btn" onclick="copyDepositAddress()" id="copyBtn">
                            📋 Copy
                        </button>
                    </div>
                    <div class="deposit-info">
                        <p class="warning-text">⚠️ Only send SOL to this address. Other tokens will be lost!</p>
                        <p class="balance-info">Current Balance: <span id="modalBalance">0.0000</span> SOL</p>
                    </div>
                </div>
                
                <div class="transaction-status" id="transactionStatus" style="display: none;">
                    <div class="status-icon">⏳</div>
                    <div class="status-text">
                        <p class="status-title">Transaction received!</p>
                        <p class="status-subtitle">Waiting for confirmations...</p>
                    </div>
                </div>
                
                <div class="deposit-info">
                    <p>💡 <strong>Enjoy 0% fees on SOL deposits & withdrawals!</strong></p>
                    <p class="processing-note">💎 Deposits are typically processed within 1-2 minutes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal-overlay" id="withdrawModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💸 Withdraw</h3>
                <button class="close-btn" onclick="closeWithdrawModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="withdraw-section">
                    <label class="input-label">Available Balance</label>
                    <div class="balance-display">
                        <span class="balance-amount" id="withdrawBalance">0.0000</span>
                        <span class="balance-currency">SOL</span>
                    </div>
                </div>
                
                <div class="withdraw-section">
                    <label class="input-label">Withdrawal Amount</label>
                    <div class="amount-input-container">
                        <input type="number" id="withdrawAmount" class="amount-input" placeholder="0.0000" step="0.0001" min="0.0001">
                        <span class="currency-label">SOL</span>
                    </div>
                    <div class="amount-buttons">
                        <button class="amount-btn" onclick="setWithdrawAmount(0.25)">25%</button>
                        <button class="amount-btn" onclick="setWithdrawAmount(0.5)">50%</button>
                        <button class="amount-btn" onclick="setWithdrawAmount(0.75)">75%</button>
                        <button class="amount-btn" onclick="setWithdrawAmount(1)">100%</button>
                    </div>
                </div>
                
                <div class="withdraw-section">
                    <label class="input-label">Your SOL Wallet Address</label>
                    <div class="address-input-container">
                        <input type="text" id="withdrawAddressInput" class="address-input" placeholder="Enter your SOL wallet address" maxlength="44">
                        <button class="paste-btn" onclick="pasteAddress()">📋 Paste</button>
                    </div>
                    <p class="address-note">💡 Enter your own SOL wallet address to receive funds</p>
                </div>
                
                <div class="withdraw-info">
                    <p class="success-text">⚡ Instant withdrawals powered by Privy!</p>
                    <p class="processing-note">💎 No fees on withdrawals!</p>
                </div>
                
                <div class="withdraw-actions">
                    <button class="withdraw-confirm-btn" onclick="confirmWithdraw()" id="confirmWithdrawBtn">
                        💸 Request Withdrawal
                    </button>
                </div>
            </div>
        </div>
    </div>



    <script>
        class SolCases {
            constructor() {
                this.isConnected = false;
                this.currentWallet = null;
                this.balance = 0;
                this.username = null;
                this.inventory = {}; // New: Inventory data
                this.level = 1;
                this.xp = 0;
                this.xpForNextLevel = 100;
                this.recentWins = []; // Store recent wins
                this.lastPackOpenTime = 0; // Track last pack open time for cool down
                this.packCooldown = 2000; // 2 second cool down between pack openings
                this.lastPackData = null; // Store last pack data for verification
                this.balanceRefreshInterval = null; // For automatic balance refresh
                this.init();
            }

            init() {
                this.checkExistingSession();
                this.loadSavedUsername();
                this.loadStats();
                this.initChat();
                this.loadInventory(); // Load inventory on init
                
                // CRITICAL SECURITY FIX: Check for pending transactions on page load
                this.checkPendingTransactionsOnLoad();
                
                // Add session retry mechanism for better persistence
                this.setupSessionRetry();
            }

            // CRITICAL SECURITY FIX: Check for pending transactions when page loads
            async checkPendingTransactionsOnLoad() {
                try {
                    const sessionId = localStorage.getItem('privy-session-id');
                    if (!sessionId) return;
                    
                    const response = await fetch('https://solcases.fun/api/transaction-status', {
                        method: 'GET',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId
                        },
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success && data.hasPendingTransaction) {
                        const transactionInfo = data.transactionInfo;
                        const ageInSeconds = Math.floor(transactionInfo.age / 1000);
                        
                        console.log(`⚠️ Found pending transaction on page load: ${transactionInfo.caseType} pack, ${ageInSeconds}s old`);
                        
                        if (ageInSeconds >= 120) { // 2 minutes or older
                            // Try to force complete the stale transaction
                            const forceResponse = await fetch('https://solcases.fun/api/force-complete-transaction', {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'X-Session-ID': sessionId
                                },
                                credentials: 'include'
                            });
                            
                            const forceData = await forceResponse.json();
                            if (forceData.success) {
                                this.balance = forceData.newBalance;
                                this.updateWalletUI();
                                this.showNotification('Recovered from interrupted transaction. Your balance has been restored.', 'success');
                            } else {
                                this.showNotification('Found pending transaction. Please wait or contact support.', 'warning');
                            }
                        } else {
                            this.showNotification(`Transaction in progress (${ageInSeconds}s old). Please wait for completion.`, 'warning');
                        }
                    }
                } catch (error) {
                    console.error('❌ Failed to check pending transactions on load:', error);
                }
            }

            async checkExistingSession() {
                try {
                    // Get session ID from localStorage
                    const sessionId = localStorage.getItem('privy-session-id');
                    
                    if (!sessionId) {
                        console.log('No session ID found in localStorage');
                        return;
                    }

                    console.log('🔍 Checking existing session with ID:', sessionId);
                    
                    // Add timeout and better error handling for OpaqueResponseBlocking
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                    
                    const response = await fetch('https://solcases.fun/api/wallet', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId
                        },
                        credentials: 'include',
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        console.error('❌ Session check failed with status:', response.status);
                        // Only clear session ID for specific error codes
                        if (response.status === 401 || response.status === 403) {
                            localStorage.removeItem('privy-session-id');
                        }
                        return;
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.currentWallet = data.walletAddress;
                        this.isConnected = true;
                        
                        // Save session ID to localStorage
                        if (data.sessionId) {
                            localStorage.setItem('privy-session-id', data.sessionId);
                        }
                        
                        await this.loadBalance();
                        await this.loadLevel();
                        this.updateWalletUI();
                        this.startAutomaticBalanceRefresh();

                        console.log('✅ Session restored successfully for wallet:', data.walletAddress);
                        
                        // Connect to chat after session is established
                        this.connectToChat();
                    } else {
                        console.log('No existing session found');
                        // Still save the session ID for future requests
                        if (data.sessionId) {
                            localStorage.setItem('privy-session-id', data.sessionId);
                        }
                    }
                } catch (error) {
                    console.error('❌ Session check error:', error);
                    
                    // Handle specific error types
                    if (error.name === 'AbortError') {
                        console.log('Session check timed out - will retry later');
                    } else if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                        console.log('Network error - will retry session check later');
                    } else if (error.message.includes('OpaqueResponseBlocking')) {
                        console.log('OpaqueResponseBlocking detected - will retry with different approach');
                        // Try alternative approach for OpaqueResponseBlocking
                        setTimeout(() => this.checkExistingSession(), 2000);
                    }
                }
            }

            setupSessionRetry() {
                // Retry session check every 30 seconds if not connected
                setInterval(() => {
                    if (!this.isConnected) {
                        const sessionId = localStorage.getItem('privy-session-id');
                        if (sessionId) {
                            console.log('🔄 Retrying session check...');
                            this.checkExistingSession();
                        }
                    }
                }, 30000); // 30 seconds
                
                // Handle page visibility changes (sleep/wake cycles)
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden && !this.isConnected) {
                        const sessionId = localStorage.getItem('privy-session-id');
                        if (sessionId) {
                            console.log('🔄 Page became visible - checking session...');
                            setTimeout(() => this.checkExistingSession(), 1000); // Small delay to ensure network is ready
                        }
                    }
                });
            }

            async connectWallet() {
                const btn = document.getElementById('connectBtn');
                btn.disabled = true;
                btn.textContent = 'Connecting...';
                
                try {
                    // Get session ID from localStorage
                    const sessionId = localStorage.getItem('privy-session-id');
                    
                    const response = await fetch('https://solcases.fun/api/create-wallet', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.currentWallet = data.walletAddress;
                        this.isConnected = true;
                        
                        // Save session ID to localStorage
                        if (data.sessionId) {
                            localStorage.setItem('privy-session-id', data.sessionId);
                        }
                        
                        await this.loadBalance();
                        await this.loadLevel();
                        this.updateWalletUI();
                        this.startAutomaticBalanceRefresh();
                        // Wallet connected successfully
                        
                        // Connect to chat after wallet is connected
                        this.connectToChat();
                    } else {
                        console.error('❌ Connection failed:', data.error || 'Unknown error');
                    }
                } catch (error) {
                    console.error('Connection failed:', error);
                }
                
                btn.disabled = false;
                btn.textContent = 'Connect Wallet';
            }

            updateWalletUI() {
                const connectBtn = document.getElementById('connectBtn');
                const depositBtn = document.getElementById('depositBtn');
                const withdrawBtn = document.getElementById('withdrawBtn');
                const walletInfo = document.getElementById('walletInfo');
                const balanceEl = document.getElementById('balance');
                const addressEl = document.getElementById('address');

                if (this.isConnected && this.currentWallet) {
                    connectBtn.classList.add('hidden');
                    depositBtn.style.display = 'inline-block';
                    withdrawBtn.style.display = 'inline-block';
                    walletInfo.classList.remove('hidden');
                    balanceEl.textContent = `${this.balance.toFixed(4)} SOL`;
                    addressEl.textContent = this.formatAddress(this.currentWallet);
                } else {
                    connectBtn.classList.remove('hidden');
                    depositBtn.style.display = 'none';
                    withdrawBtn.style.display = 'none';
                    walletInfo.classList.add('hidden');
                }
            }

            updateLevelUI() {
                const levelInfo = document.getElementById('levelInfo');
                const levelBadge = document.getElementById('levelBadge');
                const xpFill = document.getElementById('xpFill');
                const xpText = document.getElementById('xpText');

                if (this.isConnected && this.currentWallet) {
                    levelInfo.style.display = 'flex';
                    levelBadge.textContent = `Level ${this.level}`;
                    
                    // Calculate XP progress
                    const totalXPForCurrentLevel = this.getTotalXPForLevel(this.level);
                    const xpProgress = Math.max(0, this.xp - totalXPForCurrentLevel);
                    const progressPercentage = Math.min(100, Math.max(0, (xpProgress / this.xpForNextLevel) * 100));
                    
                    xpFill.style.width = `${progressPercentage}%`;
                    xpText.textContent = `${xpProgress}/${this.xpForNextLevel}`;
                } else {
                    levelInfo.style.display = 'none';
                }
            }

            getTotalXPForLevel(level) {
                if (level === 1) return 0;
                if (level === 2) return 100;
                if (level === 3) return 250;
                if (level === 4) return 450;
                if (level === 5) return 700;
                if (level === 6) return 950;
                if (level === 7) return 1300;
                if (level === 8) return 1800;
                if (level === 9) return 2400;
                if (level === 10) return 3100;
                
                // For levels beyond 10
                let totalXP = 3900; // XP needed for level 10
                for (let i = 11; i <= level; i++) {
                    totalXP += this.getXPForNextLevel(i - 1);
                }
                return totalXP;
            }

            getXPForNextLevel(currentLevel) {
                if (currentLevel === 1) return 100;
                if (currentLevel === 2) return 150;
                if (currentLevel === 3) return 200;
                if (currentLevel === 4) return 250;
                if (currentLevel === 5) return 250;
                if (currentLevel === 6) return 350;
                if (currentLevel === 7) return 500;
                if (currentLevel === 8) return 600;
                if (currentLevel === 9) return 700;
                if (currentLevel === 10) return 800;
                
                // For levels beyond 10: 500 + (level - 10) * 100
                return 500 + (currentLevel - 10) * 100;
            }



            formatAddress(address) {
                return `${address.slice(0, 4)}...${address.slice(-4)}`;
            }

            async openPack(packType) {
                if (!this.isConnected) {
                    return;
                }

                // Check cool down
                const now = Date.now();
                const timeSinceLastOpen = now - this.lastPackOpenTime;
                if (timeSinceLastOpen < this.packCooldown) {
                    return;
                }

                // CRITICAL SECURITY FIX: Check for pending transactions before opening
                try {
                    const sessionId = localStorage.getItem('privy-session-id');
                    const statusResponse = await fetch('https://solcases.fun/api/transaction-status', {
                        method: 'GET',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include'
                    });
                    
                    const statusData = await statusResponse.json();
                    
                    if (statusData.success && statusData.hasPendingTransaction) {
                        const transactionInfo = statusData.transactionInfo;
                        const ageInSeconds = Math.floor(transactionInfo.age / 1000);
                        
                        if (ageInSeconds < 120) { // Less than 2 minutes old
                            return;
                        } else {
                            // Transaction is stale, try to force complete it
    
                            const forceResponse = await fetch('https://solcases.fun/api/force-complete-transaction', {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'X-Session-ID': sessionId || ''
                                },
                                credentials: 'include'
                            });
                            
                            const forceData = await forceResponse.json();
                            if (forceData.success) {
                                this.balance = forceData.newBalance;
                                this.updateWalletUI();
                            } else {
                                return;
                            }
                        }
                    }
                } catch (error) {
                    console.error('❌ Transaction status check failed:', error);
                    return;
                }

                const packPrices = {
                    starter: 0.001,
                    pro: 0.01,
                    elite: 0.1,
                    whale: 1.0
                };

                const requiredBalance = packPrices[packType] || packPrices.starter;
                
                if (this.balance < requiredBalance) {
                    return;
                }

                // Disable all pack buttons
                const packButtons = document.querySelectorAll('.open-btn');
                packButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.textContent = 'Rolling...';
                    btn.style.animation = 'glowPulse 1s ease-in-out infinite';
                });

                try {
                    const sessionId = localStorage.getItem('privy-session-id');
                    const response = await fetch('https://solcases.fun/api/open-case', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include',
                        body: JSON.stringify({ caseType: packType })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {

                        
                        // Update last pack open time for cool down
                        this.lastPackOpenTime = Date.now();
                        
                        // Don't update balance here - it will be updated as cards are pulled
                        
                        // Update level if XP was earned
                        if (result.result.xpEarned) {
                            const oldLevel = this.level;
                            this.xp = result.result.totalXP;
                            this.level = result.result.currentLevel;
                            this.xpForNextLevel = result.result.levelUpInfo ? result.result.levelUpInfo.xpForNextLevel : this.getXPForNextLevel(this.level);
                            
                            this.updateLevelUI();
                        }
                        
                        // Show clickable interface for all packs
                        this.showClickablePackInterface(result.result, packType);
                        
                        this.updateStats();
                        this.updateStatsWithAnimation(); // Add animation to stats
                        
                        // Show provably fair verification data
                        this.showProvablyFairVerification(result.result);
                        
                        // Don't add cards to inventory here - they'll be added when pulled individually

                        // Post to chat for big wins (50x and above)
                        if (result.result.totalMultiplier >= 50) {
                            const packName = this.getPackDisplayName(packType);
                            setTimeout(() => {
                                this.addChatMessage('SolCases.fun', `Just hit ${result.result.totalMultiplier}x on ${packName}! Won ${result.result.totalWinAmount.toFixed(4)} SOL 🎉`, true, this.level || 1);
                            }, 2000);
                        }
                        
                        // Send pack opening message to WebSocket chat (only for 50x and above)
                        if (result.result.totalMultiplier >= 50 && this.ws && this.ws.readyState === WebSocket.OPEN) {
                            const packName = this.getPackDisplayName(packType);
                            
                            // Create message showing the best card if multiple cards
                            let bestCard = null;
                            if (result.result.cards && result.result.cards.length > 0) {
                                bestCard = result.result.cards.reduce((best, current) => 
                                    current.multiplier > best.multiplier ? current : best
                                );
                            }
                            
                            const itemName = bestCard ? this.getItemName(bestCard.rarity) : this.getItemName(result.result.rarity);
                            const rarity = bestCard ? bestCard.rarity : result.result.rarity;
                            const multiplier = bestCard ? bestCard.multiplier : result.result.totalMultiplier;
                            
                            const chatMessage = `SolCases.fun opened ${packName} and got ${itemName} (${rarity}) - ${multiplier}x!`;
                            this.ws.send(JSON.stringify({
                                type: 'chat_message',
                                content: chatMessage
                            }));
                        }

                        // Send pack opening notification to WebSocket for live feedback (5x and above)
                        if (result.result.totalMultiplier >= 5 && this.ws && this.ws.readyState === WebSocket.OPEN) {
                            const packName = this.getPackDisplayName(packType);
                            const bestRarity = this.getBestRarity(result.result);
                            
                            this.ws.send(JSON.stringify({
                                type: 'pack_opened',
                                username: 'SolCases.fun',
                                amount: result.result.totalWinAmount.toFixed(4),
                                pack: packName,
                                rarity: bestRarity,
                                multiplier: result.result.totalMultiplier
                            }));
                        }
                    } else {
                        // Failed to open pack
                    }
                } catch (error) {
                    console.error('❌ Pack opening error:', error);
                    console.error('Error details:', error.message, error.stack);
                }

                // Re-enable pack buttons
                packButtons.forEach((btn, index) => {
                    btn.disabled = false;
                    btn.style.animation = '';
                    const packNames = ['Open Silver Pack', 'Open Gold Pack', 'Open Diamond Pack', 'Open Obsidian Pack'];
                    btn.textContent = packNames[index] || 'Open Pack';
                });
            }

            showPackResult(result, packType) {

                
                // Extract data from backend response format
                const { cards, totalWinAmount, totalMultiplier } = result;
                
                // Create item data based on rarity
                const items = {
                    common: { name: 'Bronze Coin', icon: '🥉' },
                    uncommon: { name: 'Silver Coin', icon: '🥈' },
                    rare: { name: 'Gold Coin', icon: '🥇' },
                    epic: { name: 'Fire Sword', icon: '🔥' },
                    legendary: { name: 'Diamond Crown', icon: '💎' },
                    mythic: { name: 'Crystal Orb', icon: '🔮' },
                    divine: { name: 'Godly Artifact', icon: '👑' }
                };
                
                // Create result modal/popup with animations
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    animation: fadeIn 0.3s ease-out forwards;
                `;

                const content = document.createElement('div');
                content.style.cssText = `
                    background: var(--bg-card);
                    border: 1px solid var(--border);
                    border-radius: 20px;
                    padding: 40px;
                    text-align: center;
                    max-width: 900px;
                    width: 90%;
                `;

                const totalMultiplierText = (totalMultiplier || result.multiplier || 0) > 0 ? `${(totalMultiplier || result.multiplier || 0)}x` : 'BUST';
                const totalValueText = (totalWinAmount || result.amount || 0) > 0 ? `${(totalWinAmount || result.amount || 0).toFixed(4)} SOL` : '0 SOL';
                
                // Create cards HTML with staggered animations
                let cardsHTML = '';
                
                // Handle both new multi-card format and old single-card format
                const cardsToShow = cards || [{ 
                    rarity: result.rarity || 'common', 
                    multiplier: result.multiplier || 0, 
                    winAmount: result.amount || 0 
                }];
                
                cardsToShow.forEach((card, index) => {
                    const item = items[card.rarity] || items.common;
                    const rarityColor = {
                        common: '#9ca3af',
                        uncommon: '#10b981',
                        rare: '#3b82f6',
                        epic: '#8b5cf6',
                        legendary: '#f59e0b',
                        mythic: '#ec4899',
                        divine: '#fbbf24'
                    }[card.rarity] || '#9ca3af';
                    
                    const cardMultiplierText = card.multiplier > 0 ? `${card.multiplier}x` : 'BUST';
                    const cardValueText = card.winAmount > 0 ? `${card.winAmount.toFixed(4)} SOL` : '0 SOL';
                    
                    // Get range information for this rarity
                    const packData = getPackData(packType || 'starter');
                    const rarityData = packData.odds.find(odd => odd.rarity === card.rarity);
                    const rangeText = rarityData ? `${rarityData.range[0]} - ${rarityData.range[1]}` : 'N/A';
    
                    const rollText = card.roll ? `Rolled: ${Math.floor(Number(card.roll))}` : '';
                    
                    // Determine if this is a rare card for special styling
                    const isRareCard = ['rare', 'epic', 'legendary', 'mythic', 'divine'].includes(card.rarity);
                    
                    cardsHTML += `
                        <div class="pack-card-result" style="
                            width: 200px;
                            min-height: 250px;
                            padding: 20px;
                            border-radius: 12px;
                            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
                            border: 2px solid ${rarityColor}40;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            text-align: center;
                            position: relative;
                            overflow: hidden;
                        ">
                            <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div style="position: relative; display: inline-block;">
                                    <img src="${this.getImageUrl(card.itemName || 'red-cube') || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjMyIiB5PSIzMiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5BPC90ZXh0Pgo8L3N2Zz4K'}" 
                                         alt="${card.itemName || 'item'}" 
                                         style="width: 180px; height: 180px; object-fit: contain; margin-bottom: 10px;"
                                         onerror="console.log('Image failed to load:', this.src); this.style.display='none'; this.nextElementSibling.style.display='block';"
                                         onload="console.log('Image loaded successfully:', this.src); this.nextElementSibling.style.display='none';">
                                    
                                    <div style="
                                        position: absolute;
                                        top: 5px;
                                        left: 5px;
                                        color: ${rarityColor}; 
                                        font-size: 10px; 
                                        font-weight: 700; 
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                        padding: 4px 8px;
                                        background: rgba(0, 0, 0, 0.9);
                                        border-radius: 8px;
                                        border: 1px solid ${rarityColor};
                                        z-index: 10;
                                    ">${card.rarity}</div>
                                    
                                    <div style="
                                        position: absolute;
                                        bottom: 5px;
                                        right: 5px;
                                        color: var(--accent-primary); 
                                        font-size: 18px; 
                                        font-weight: 700;
                                        padding: 4px 8px;
                                        background: rgba(0, 0, 0, 0.9);
                                        border-radius: 8px;
                                        border: 1px solid var(--accent-primary);
                                        z-index: 10;
                                    ">${cardMultiplierText}</div>
                                </div>
                                <div style="font-size: 32px; margin-bottom: 10px;">${card.itemIcon || item.icon}</div>
                                
                                <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 6px;">${cardValueText}</div>
                                <div style="color: var(--text-secondary); font-size: 10px; margin-bottom: 4px;">Range: ${rangeText}</div>
                                <div style="color: var(--accent-primary); font-size: 11px; font-weight: 600;">${rollText}</div>
                            </div>
                        </div>
                    `;
                });

                content.innerHTML = `
                    <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 28px;">Pack Results</h2>
                    <div style="margin-bottom: 25px; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap;">
                        ${cardsHTML}
                    </div>
                    <div id="total-results" style="border-top: 1px solid var(--border); padding-top: 20px; margin-top: 20px;">
                        <div style="color: var(--accent-primary); font-size: 28px; font-weight: 700; margin-bottom: 10px;">Total: ${totalMultiplierText}</div>
                        <div style="color: var(--text-secondary); margin-bottom: 20px;">${totalValueText}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
                        border: none;
                        padding: 12px 30px;
                        border-radius: 12px;
                        color: #0d1421;
                        font-weight: 600;
                        cursor: pointer;
                        font-family: 'Skranji', sans-serif;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">Continue</button>
                `;

                modal.appendChild(content);
                document.body.appendChild(modal);


                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (modal.parentElement) {
                        modal.remove();
        
                    }
                }, 5000);
            }

            showClickablePackInterface(result, packType) {

                
                // Store the pack data for single card pulls
                this.packData = result;
                this.cardsRemaining = result.cards ? result.cards.length : 1;
                this.cardsPulled = [];
                this.currentTotalMultiplier = 0; // Track running total multiplier
                
                // Create modal for Obsidian Pack interface
                const modal = document.createElement('div');
                modal.id = 'packModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    animation: fadeIn 0.3s ease-out forwards;
                `;

                const content = document.createElement('div');
                content.style.cssText = `
                    background: var(--bg-card);
                    border: 1px solid var(--border);
                    border-radius: 20px;
                    padding: 40px;
                    text-align: center;
                    max-width: 600px;
                    width: 90%;
                `;

                const packNames = {
                    starter: 'Silver Pack',
                    pro: 'Gold Pack',
                    elite: 'Diamond Pack',
                    whale: 'Obsidian Pack'
                };
                
                const packImages = {
                    starter: 'https://media.discordapp.net/attachments/1404212130269630504/1404225616328527983/Projekt_bez_nazwy_3.png?ex=689db644&is=689c64c4&hm=2275dadd5c9b752df0925dcc7fcb816900857069fcd38cc44d2726d40057c8b4&=&format=webp&quality=lossless',
                    pro: 'https://media.discordapp.net/attachments/1404212130269630504/1404225941126906026/Projekt_bez_nazwy_5.png?ex=689db691&is=689c6511&hm=fc9c863ad81a8feca3dc023209a5390962601150053272ab5d848fbbc0fd5d27&=&format=webp&quality=lossless',
                    elite: 'https://media.discordapp.net/attachments/1404212130269630504/1404226342454820954/Projekt_bez_nazwy_7.png?ex=689db6f1&is=689c6571&hm=2eaa0641c20f87d0cb36bb52fe5a3edc3290114563cb1c836019fef5e3cfdc45&=&format=webp&quality=lossless&width=233&height=350',
                    whale: 'https://media.discordapp.net/attachments/1404212130269630504/1404238941980200990/9be4f6f9-70d8-4607-9605-c368ff19d72a.png?ex=689dc2ad&is=689c712d&hm=4d7363f1ea402ba0f75e35fe04e35b54ebc45ca66b76e9b52a952fcb98c65f41&=&format=webp&quality=lossless&width=670&height=1006'
                };
                
                const packName = packNames[packType] || 'Pack';
                const packImage = packImages[packType] || '/images/starter-pack.png';
                
                content.innerHTML = `
                    <h2 style="color: var(--text-primary); margin-bottom: 25px; font-size: 28px;">${packName}</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">Click on the pack to reveal your cards one by one!</p>
                    

                    
                    <div style="margin-bottom: 30px; text-align: center;">
                        <img src="${packImage}" 
                             alt="${packName}" 
                             style="width: 200px; height: auto; cursor: pointer; transition: transform 0.2s ease; border-radius: 10px; display: block; margin: 0 auto;"
                             onclick="solCases.pullCard()"
                             onmouseover="this.style.transform='scale(1.05)'"
                             onmouseout="this.style.transform='scale(1)'">
                    </div>
                    
                    <div id="cardsContainer" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 10px;">
                        <!-- Cards will be added here -->
                    </div>
                    
                    <div id="progress" style="color: var(--text-secondary); margin-bottom: 10px;">
                        Cards remaining: ${this.cardsRemaining}
                    </div>
                    
                    <div id="multiplierDisplay" style="
                        background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
                        color: #0d1421;
                        padding: 10px 20px;
                        border-radius: 10px;
                        font-weight: 600;
                        font-size: 16px;
                        margin-bottom: 20px;
                        text-align: center;
                        font-family: 'Skranji', sans-serif;
                    ">
                        Multiplier: 0.00x
                    </div>
                    
                    <button id="closeBtn" onclick="solCases.closePack()" style="
                        background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
                        border: none;
                        padding: 12px 30px;
                        border-radius: 12px;
                        color: #0d1421;
                        font-weight: 600;
                        cursor: pointer;
                        font-family: 'Skranji', sans-serif;
                        transition: all 0.3s ease;
                        opacity: 0.5;
                        pointer-events: none;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">Pull All Cards First</button>
                `;

                modal.appendChild(content);
                document.body.appendChild(modal);
            }

            pullCard() {
                if (this.cardsRemaining <= 0) {
                    return;
                }

                // Get the next card
                const card = this.packData.cards[this.cardsPulled.length];
                this.cardsPulled.push(card);
                this.cardsRemaining--;

                // Update running total multiplier
                this.currentTotalMultiplier += card.multiplier;

                // Update progress
                const progressElement = document.getElementById('progress');
                if (progressElement) {
                    progressElement.textContent = `Cards remaining: ${this.cardsRemaining}`;
                }

                // Update multiplier display
                const multiplierElement = document.getElementById('multiplierDisplay');
                if (multiplierElement) {
                    multiplierElement.textContent = `Multiplier: ${this.currentTotalMultiplier.toFixed(2)}x`;
                    
                    // Add a brief highlight animation
                    multiplierElement.style.animation = 'none';
                    setTimeout(() => {
                        multiplierElement.style.animation = 'glowPulse 0.5s ease-in-out';
                    }, 10);
                }

                // Add card to display with animation
                this.addCardToDisplay(card);

                // Add to inventory
                const itemName = this.getItemName(card.rarity);
                this.addToInventory(itemName, card.rarity);

                // Update balance with the card's win amount
                this.balance += card.winAmount;
                this.updateWalletUI();

                // Show card pull animation
                this.showCardPullAnimation(card);

                // If no more cards, enable close button
                if (this.cardsRemaining === 0) {
                    const closeBtn = document.getElementById('closeBtn');
                    if (closeBtn) {
                        closeBtn.style.opacity = '1';
                        closeBtn.style.pointerEvents = 'auto';
                        closeBtn.textContent = 'Close Pack';
                    }
                    
                    // Update stats after all cards are pulled
                    this.updateStats();
                    this.updateStatsWithAnimation();
                }
            }

            addCardToDisplay(card) {
                const container = document.getElementById('cardsContainer');
                if (!container) return;

                const items = {
                    common: { name: 'Bronze Coin', icon: '🥉' },
                    uncommon: { name: 'Silver Coin', icon: '🥈' },
                    rare: { name: 'Gold Coin', icon: '🥇' },
                    epic: { name: 'Fire Sword', icon: '🔥' },
                    legendary: { name: 'Diamond Crown', icon: '💎' },
                    mythic: { name: 'Crystal Orb', icon: '🔮' },
                    divine: { name: 'Godly Artifact', icon: '👑' }
                };

                const item = items[card.rarity] || items.common;
                const rarityColor = {
                    common: '#9ca3af',
                    uncommon: '#10b981',
                    rare: '#3b82f6',
                    epic: '#8b5cf6',
                    legendary: '#f59e0b',
                    mythic: '#ec4899',
                    divine: '#fbbf24'
                }[card.rarity] || '#9ca3af';

                const cardElement = document.createElement('div');
                cardElement.style.cssText = `
                    width: 120px;
                    height: 112px;
                    padding: 10px;
                    border-radius: 12px;
                    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
                    border: 2px solid ${rarityColor}40;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    animation: cardSlideIn 0.5s ease-out;
                    margin: 8px;
                    position: relative;
                    overflow: hidden;
                `;

                cardElement.innerHTML = `
                    <div style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                        <div style="position: relative; display: inline-block;">
                            <img src="${this.getImageUrl(card.itemName || 'red-cube') || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjE2IiB5PSIxNiIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+TkE8L3RleHQ+Cjwvc3ZnPgo='}" 
                                 alt="${card.itemName || 'item'}" 
                                 style="width: 110px; height: 110px; object-fit: contain; margin-bottom: 5px;"
                                 onerror="console.log('Small image failed to load:', this.src); this.style.display='none'; this.nextElementSibling.style.display='block';"
                                 onload="console.log('Small image loaded successfully:', this.src); this.nextElementSibling.style.display='none';">
                            
                            <div style="
                                position: absolute;
                                top: 2px;
                                left: 2px;
                                color: ${rarityColor}; 
                                font-size: 9px; 
                                font-weight: 700; 
                                text-transform: uppercase;
                                letter-spacing: 0.5px;
                                padding: 3px 6px;
                                background: rgba(0, 0, 0, 0.8);
                                border-radius: 6px;
                                border: 1px solid ${rarityColor};
                                z-index: 10;
                            ">${card.rarity}</div>
                            
                            <div style="
                                position: absolute;
                                bottom: 8px;
                                right: 2px;
                                color: var(--accent-primary); 
                                font-size: 14px; 
                                font-weight: 700;
                                padding: 3px 6px;
                                background: rgba(0, 0, 0, 0.8);
                                border-radius: 6px;
                                border: 1px solid var(--accent-primary);
                                z-index: 10;
                            ">${card.multiplier}x</div>
                        </div>

                    </div>
                `;

                container.appendChild(cardElement);
            }

            showCardPullAnimation(card) {
                // Create a floating animation for the pulled card
                const animation = document.createElement('div');
                animation.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 48px;
                    z-index: 1001;
                    pointer-events: none;
                    animation: cardFloat 1s ease-out forwards;
                `;

                const items = {
                    common: { icon: '🥉' },
                    uncommon: { icon: '🥈' },
                    rare: { icon: '🥇' },
                    epic: { icon: '🔥' },
                    legendary: { icon: '💎' },
                    mythic: { icon: '🔮' },
                    divine: { icon: '👑' }
                };

                const item = items[card.rarity] || items.common;
                                 // Create image element instead of text
                 const img = document.createElement('img');
                 img.src = this.getImageUrl(card.itemName || 'red-cube') || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjQ4IiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjI0IiB5PSIyNCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5BPC90ZXh0Pgo8L3N2Zz4K';
                 img.alt = card.itemName || 'item';
                 img.style.cssText = `
                     width: 200px;
                     height: 200px;
                     object-fit: contain;
                     margin-top: 15px;
                 `;
                 img.onerror = function() {
                     this.style.display = 'none';
                     animation.textContent = card.itemIcon || item.icon;
                 };
                 
                 animation.appendChild(img);

                document.body.appendChild(animation);

                // Remove animation element after animation completes
                setTimeout(() => {
                    if (animation.parentElement) {
                        animation.remove();
                    }
                }, 1000);
            }

            closePack() {
                const modal = document.getElementById('packModal');
                if (modal) {
                    modal.remove();
                }
                this.packData = null;
                this.cardsRemaining = 0;
                this.cardsPulled = [];
                this.currentTotalMultiplier = 0;
            }



            showProvablyFairVerification(packData) {
                // Store pack data for verification
                this.lastPackData = packData;
                
                // Store pack data in localStorage for the provably fair page
                localStorage.setItem('lastPackData', JSON.stringify(packData));
                
                // Debug: Log the pack data to see what we're receiving

                
                // Show notification that verification data is available
    
            }



            async loadStats() {
                try {
                    const response = await fetch('https://solcases.fun/api/stats');
                    const data = await response.json();
                    
                    if (data.success) {
                        const packsElement = document.getElementById('packsOpened');
                        const wonElement = document.getElementById('totalWon');
                        
                        if (packsElement) packsElement.textContent = data.stats.packsOpened;
                        if (wonElement) wonElement.textContent = data.stats.solWon;
                    } else {
                        // Fallback values
                        const packsElement = document.getElementById('packsOpened');
                        const wonElement = document.getElementById('totalWon');
                        
                        if (packsElement) packsElement.textContent = '0';
                        if (wonElement) wonElement.textContent = '0.00';
                    }
                } catch (error) {
                    console.error('Failed to load stats:', error);
                    // Fallback values with null checks
                    const packsElement = document.getElementById('packsOpened');
                    const wonElement = document.getElementById('totalWon');
                    
                    if (packsElement) packsElement.textContent = '0';
                    if (wonElement) wonElement.textContent = '0.00';
                }
            }

            async loadBalance() {
                try {
                    const sessionId = localStorage.getItem('privy-session-id');
                    const response = await fetch('https://solcases.fun/api/balance', {
                        method: 'GET',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.balance = data.balance;
                        this.updateWalletUI();
        
                    } else {
                        console.log('⚠️ Balance load failed:', data.message);
                    }
                } catch (error) {
                    console.error('Failed to load balance:', error);
                }
            }

            startAutomaticBalanceRefresh() {
                // Clear any existing interval
                if (this.balanceRefreshInterval) {
                    clearInterval(this.balanceRefreshInterval);
                }
                
                // Start automatic balance refresh every 10 seconds
                this.balanceRefreshInterval = setInterval(async () => {
                    if (this.isConnected) {
                        await this.loadBalance();
                    }
                }, 10000); // 10 seconds
                

            }

            updateBalanceWithAnimation(newBalance) {
                const balanceElement = document.getElementById('balance');
                if (!balanceElement) return;

                const oldBalance = this.balance;
                this.balance = newBalance;
                
                // Add animation class
                balanceElement.classList.add('updating');
                
                // Update the display
                balanceElement.textContent = `${this.balance.toFixed(4)} SOL`;
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    balanceElement.classList.remove('updating');
                }, 600);
                
                // Show balance change notification if significant
                const balanceChange = this.balance - oldBalance;
                if (Math.abs(balanceChange) > 0.001) {
                    const changeType = balanceChange > 0 ? 'success' : 'info';
                    const changeText = balanceChange > 0 ? `+${balanceChange.toFixed(4)} SOL` : `${balanceChange.toFixed(4)} SOL`;
                    this.showBalanceNotification(changeText, changeType);
                }
            }

            async loadLevel() {

                try {
                    const sessionId = localStorage.getItem('privy-session-id');
    
                    
                    // Load from API (sessions.json has CORS issues with file:// protocol)
                    const response = await fetch('https://solcases.fun/api/level', {
                        method: 'GET',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
    
                    
                    if (data.success) {
                        this.level = data.level;
                        this.xp = data.totalXP;
                        this.xpForNextLevel = data.xpForNextLevel;
                        this.updateLevelUI();
                        
                    } else {
                        console.log('⚠️ Level load failed:', data.message);
                    }
                } catch (error) {
                    console.error('Failed to load level:', error);
                }
            }

            async updateStats() {
                // Reload fresh stats from server
                await this.loadStats();
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 12px;
                    color: white;
                    font-weight: 600;
                    z-index: 1000;
                    transition: all 0.3s ease;
                    ${type === 'success' ? 'background: var(--accent-primary); color: black;' : ''}
                    ${type === 'error' ? 'background: var(--accent-secondary);' : ''}
                    ${type === 'warning' ? 'background: #ff8800;' : ''}
                    ${type === 'info' ? 'background: var(--bg-card); border: 1px solid var(--border);' : ''}
                `;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            showBalanceNotification(message, type = 'info') {
                const notification = document.getElementById('balanceNotification');
                notification.textContent = message;
                notification.className = `balance-notification ${type}`;
                
                // Show notification
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                // Hide after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Chat functionality
            initChat() {
                this.setupChatInput();
                // Don't connect to chat here - will be done after session is established
                
                this.addSystemMessage('Welcome to SolCases.fun! Chat with other players while you gamble 🎰');
            }

            setupChatInput() {
                const chatInput = document.getElementById('chatInput');
                
                // Auto-resize textarea
                chatInput.addEventListener('input', () => {
                    chatInput.style.height = 'auto';
                    chatInput.style.height = Math.min(chatInput.scrollHeight, 100) + 'px';
                });

                // Send on Enter (but allow Shift+Enter for new lines)
                chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
            }

            connectToChat() {
                try {
                    // Prevent multiple connections
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        return;
                    }
                    
                    // Get sessionId from localStorage (should be privy-session-id)
                    const sessionId = localStorage.getItem('privy-session-id');
                    
                    if (!sessionId) {
                        this.addSystemMessage('No session ID available. Chat will work locally.');
                        return;
                    }
                    
                    // Try to connect to the server
                    this.ws = new WebSocket(`wss://solcases.fun?sessionId=${sessionId}`);
                    
                    this.ws.onopen = () => {
                        this.addSystemMessage('Connected to live chat! 🎉');
                        // Update connection status
                        const onlineStatus = document.getElementById('chatOnlineCount');
                        if (onlineStatus) {
                            onlineStatus.style.color = '#22c55e'; // Green for connected
                        }
                    };
                    
                    this.ws.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            
                            switch (data.type) {
                                case 'online_count':
                                    document.getElementById('chatOnlineCount').textContent = data.count;
                                    break;
                                case 'chat_history':
                                    // Only load history if chat is empty (first connection)
                                    const messagesContainer = document.getElementById('chatMessages');
                                    if (messagesContainer.children.length <= 1) { // Only system message
                                        data.messages.forEach(msg => {
                                            if (msg.type === 'user') {
                                                this.addChatMessage(msg.username, msg.content, false, msg.level || 1);
                                            } else if (msg.type === 'system') {
                                                this.addSystemMessage(msg.content);
                                            }
                                        });
                                    }
                                    break;
                                case 'user':
                    
                                    this.addChatMessage(data.username, data.content, false, data.level || 1);
                                    break;
                                case 'system':
                                    this.addSystemMessage(data.content);
                                    break;
                                case 'username_loaded':
                                    // Server loaded a saved username
                                    if (data.username && data.username !== this.username) {
                                        this.username = data.username;
                                        // Save to localStorage to keep it persistent
                                        localStorage.setItem('solcases-username', data.username);
                                        const usernameSection = document.getElementById('usernameSection');
                                        if (usernameSection) {
                                            usernameSection.style.display = 'none';
                                        }
                                        this.addSystemMessage(`Welcome back, ${data.username}! ✨`);
                                    }
                                    break;
                                case 'pack_opened':
                                    // Handle real-time pack opening from other players
                                    // Recent wins functionality removed
                                    break;
                            }
                        } catch (error) {
                            console.error('❌ Chat message parse error:', error);
                        }
                    };
                    
                    this.ws.onclose = () => {
                        this.addSystemMessage('Chat disconnected. Refresh page to reconnect.');
                    };
                    
                    this.ws.onerror = (error) => {
                        this.addSystemMessage('Chat connection error. Will retry... 🔄');
                    };
                    
                } catch (error) {
                    console.error('❌ Failed to connect to chat:', error);
                    this.addSystemMessage('Failed to connect to chat. Using local mode.');
                }
            }

            sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (!message) return;

                // Check message length limit (100 characters)
                if (message.length > 100) {
                    this.addSystemMessage('⚠️ Message too long! Maximum 100 characters allowed.');
                    return;
                }

                // Check cooldown (1 second between messages)
                const now = Date.now();
                if (this.lastMessageTime && (now - this.lastMessageTime) < 1000) {
                    this.addSystemMessage('⚠️ Please wait 1 second between messages.');
                    return;
                }

                // Filter the message for offensive content
                const filteredMessage = this.filterMessage(message);
                
                // If message was filtered, show warning and don't send
                if (filteredMessage !== message) {
                    this.addSystemMessage('⚠️ Message contains inappropriate content and was blocked.');
                    return;
                }

                // Update last message time
                this.lastMessageTime = now;

                // Send via WebSocket if connected
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        type: 'chat_message',
                        content: message
                    }));
                } else {
                    // Fallback to local message
                    const username = this.username || this.formatAddress(this.currentWallet) || 'Anonymous';
                    this.addChatMessage(username, message, true, this.level || 1);
                }
                
                input.value = '';
                input.style.height = 'auto';
            }

            filterMessage(content) {
                const offensiveWords = [
                    'nigga', 'nigger', 'cp', 'child porn', 'kid'
                ];
                
                let filteredContent = content.toLowerCase();
                
                for (const word of offensiveWords) {
                    // Create regex pattern to match the word with word boundaries
                    const regex = new RegExp(`\\b${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, 'gi');
                    filteredContent = filteredContent.replace(regex, '***');
                }
                
                // If any words were filtered, return the filtered content
                if (filteredContent !== content.toLowerCase()) {
                    return filteredContent;
                }
                
                return content; // Return original if no filtering needed
            }

            loadSavedUsername() {
                const savedUsername = localStorage.getItem('solcases-username');
                if (savedUsername) {
                    this.username = savedUsername;
                    
                    // Hide the username section if username is already set
                    const usernameSection = document.getElementById('usernameSection');
                    if (usernameSection) {
                        usernameSection.style.display = 'none';
                    }
                    
                    // Show username in chat header or somewhere visible
                    this.addSystemMessage(`Welcome back, ${savedUsername}! ✨`);
                    
                    console.log('✅ Loaded saved username:', savedUsername);
                } else {
                    // Show username section for new users
                    const usernameSection = document.getElementById('usernameSection');
                    if (usernameSection) {
                        usernameSection.style.display = 'block';
                        this.addSystemMessage('Please set your username to start chatting!');
                    }
                }
            }

            setUsername() {
                const input = document.getElementById('usernameInput');
                const username = input.value.trim();
                
                if (!username) {
                    this.addSystemMessage('Please enter a username!');
                    return;
                }
                
                if (username.length > 20) {
                    this.addSystemMessage('Username must be 20 characters or less!');
                    return;
                }
                
                this.username = username;
                
                // Save username to localStorage for persistence
                localStorage.setItem('solcases-username', username);
                
                // Hide the username section completely
                const usernameSection = document.getElementById('usernameSection');
                if (usernameSection) {
                    usernameSection.style.display = 'none';
                }
                
                this.addSystemMessage(`Username set to: ${username} ✨`);
                
                // Send username update to server if connected
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        type: 'username_update',
                        username: username
                    }));
                }
            }

            addChatMessage(username, message, isOwn = false, level = 1) {

                const messagesContainer = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';

                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                messageDiv.innerHTML = `
                    <div class="message-header">
                        <span class="message-username">${username}</span>
                        <span class="message-level">Level ${level}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-content ${isOwn ? 'own' : ''}">${message}</div>
                `;

                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Limit to 50 messages
                const messages = messagesContainer.querySelectorAll('.chat-message');
                if (messages.length > 50) {
                    messages[0].remove();
                }
            }

            addSystemMessage(message) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';

                messageDiv.innerHTML = `
                    <div class="message-content system">${message}</div>
                `;

                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }



            // Inventory functionality
            async loadInventory() {
                try {
                    const sessionId = localStorage.getItem('privy-session-id');
                    const response = await fetch('https://solcases.fun/api/inventory', {
                        method: 'GET',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.inventory = data.inventory;
                        this.renderInventory();
                        console.log('🎁 Inventory loaded:', this.inventory);
                    } else {
                        console.log('⚠️ Inventory load failed:', data.message);
                        this.inventory = {}; // Ensure inventory is empty on failure
                        this.renderInventory();
                    }
                } catch (error) {
                    console.error('Failed to load inventory:', error);
                    // For now, use a mock inventory until backend is updated
                    this.inventory = this.getMockInventory();
                    this.renderInventory();
                }
            }

            getMockInventory() {
                // Mock inventory data for testing
                const mockInventory = localStorage.getItem('mock-inventory');
                if (mockInventory) {
                    try {
                        return JSON.parse(mockInventory);
                    } catch (e) {
                        return {};
                    }
                }
                return {};
            }

            async addToInventory(itemName, rarity) {
                // Initialize inventory structure if needed
                if (!this.inventory[rarity]) {
                    this.inventory[rarity] = {};
                }
                
                // Add or increment item count
                if (!this.inventory[rarity][itemName]) {
                    this.inventory[rarity][itemName] = 0;
                }
                this.inventory[rarity][itemName]++;
                
                // Save to server
                try {
                    const sessionId = localStorage.getItem('privy-session-id');
                    const response = await fetch('https://solcases.fun/api/inventory', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Session-ID': sessionId || ''
                        },
                        credentials: 'include',
                        body: JSON.stringify({ inventory: this.inventory })
                    });
                    
                    const data = await response.json();
                    if (!data.success) {
                        console.error('Failed to save inventory:', data.message);
                    }
                } catch (error) {
                    console.error('Error saving inventory:', error);
                }
                
                // Re-render inventory
                this.renderInventory();
                
                console.log(`🎁 Added ${itemName} (${rarity}) to inventory`);
            }

            renderInventory() {
                const inventoryGrid = document.getElementById('inventoryGrid');
                const emptyInventory = document.getElementById('emptyInventory');
                inventoryGrid.innerHTML = ''; // Clear previous inventory items

                if (Object.keys(this.inventory).length === 0) {
                    emptyInventory.style.display = 'block';
                } else {
                    emptyInventory.style.display = 'none';
                    for (const rarity in this.inventory) {
                        for (const itemName in this.inventory[rarity]) {
                            const count = this.inventory[rarity][itemName];
                            const cardElement = document.createElement('div');
                            cardElement.className = 'inventory-card';
                            cardElement.innerHTML = `
                                <div class="card-icon">${this.getCardIcon(rarity)}</div>
                                <div class="card-name">${itemName}</div>
                                <div class="card-rarity rarity-${rarity}">${rarity.charAt(0).toUpperCase() + rarity.slice(1)}</div>
                                <div class="card-count">x${count}</div>
                            `;
                            inventoryGrid.appendChild(cardElement);
                        }
                    }
                }
            }

            getCardIcon(rarity) {
                switch (rarity) {
                    case 'common': return '🥉';
                    case 'uncommon': return '🥈';
                    case 'rare': return '🥇';
                    case 'epic': return '🔥';
                    case 'legendary': return '💎';
                    case 'mythic': return '🎁';
                    case 'divine': return '🐋';
                    default: return '📦'; // Default for unknown rarities
                }
            }

            getItemName(rarity) {
                const items = {
                    common: ['Copper Coin', 'Bronze Token', 'Iron Ore'],
                    uncommon: ['Silver Coin', 'Crystal Shard', 'Magic Scroll'],
                    rare: ['Gold Coin', 'Ruby Gem', 'Lightning Bolt'],
                    epic: ['Platinum Bar', 'Dragon Scale', 'Fire Sword'],
                    legendary: ['Diamond Crown', 'Phoenix Feather', 'Star Fragment'],
                    mythic: ['Cosmic Orb', 'Time Crystal', 'Void Essence'],
                    divine: ['God Stone', 'Universe Key', 'Infinity Crystal']
                };
                
                const rarityItems = items[rarity] || items.common;
                return rarityItems[Math.floor(Math.random() * rarityItems.length)];
            }



            getImageUrl(itemName) {
                // All item URLs - colors are random, no special meaning
                const allUrls = {
                    // Red variants
                    'red-cube': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-cube.png?updatedAt=1754994590917',
                    'red-dice': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-dice.png?updatedAt=1754994590917',
                    'red-banana': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-banana.png?updatedAt=1754994589845',
                    'red-fish': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-fish.png?updatedAt=1754994591933',
                    'red-rock': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-rock.png?updatedAt=1754994593399',
                    'red-cup': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-cup.png?updatedAt=1754994591186',
                    'red-leaf': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-leaf.png?updatedAt=1754994590917',
                    'red-cloud': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-cloud.png?updatedAt=1754994589939',
                    'red-mushroom': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-mushroom.png?updatedAt=1754994593382',
                    'red-toiletpaper': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-toilerpaper.png?updatedAt=1754994594676',
                    
                    // Blue variants
                    'blue-cube': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-cube.png?updatedAt=1754994572417',
                    'blue-dice': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-dice.png?updatedAt=1754994572417',
                    'blue-banana': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-banana.png?updatedAt=1754994572439',
                    'blue-fish': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-fish.png?updatedAt=1754994575171',
                    'blue-rock': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-rock.png?updatedAt=1754994575512',
                    'blue-cup': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-cup.png?updatedAt=1754994572376',
                    'blue-leaf': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-leaf.png?updatedAt=1754994572417',
                    'blue-cloud': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-cloud.png?updatedAt=1754994572422',
                    'blue-mushroom': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-mushroom.png?updatedAt=1754994575224',
                    'blue-toiletpaper': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-toilerpaper.png?updatedAt=1754994577116',
                    
                    // Green variants
                    'green-cube': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-cube.png?updatedAt=1754994579208',
                    'green-dice': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-dice.png?updatedAt=1754994579208',
                    'green-banana': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-banana.png?updatedAt=1754994577987',
                    'green-fish': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-fish.png?updatedAt=1754994580517',
                    'green-rock': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-rock.png?updatedAt=1754994582359',
                    'green-cup': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-cup.png?updatedAt=1754994579175',
                    'green-leaf': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-leaf.png?updatedAt=1754994579208',
                    'green-cloud': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-cloud.png?updatedAt=1754994579189',
                    'green-mushroom': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-mushroom.png?updatedAt=1754994581971',
                    'green-toiletpaper': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-toiletpaper.png?updatedAt=1754994583197',
                    
                    // Yellow variants
                    'yellow-cube': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-cube.png?updatedAt=1754994597168',
                    'yellow-dice': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-dice.png?updatedAt=1754994597168',
                    'yellow-banana': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-banana.png?updatedAt=1754994595991',
                    'yellow-fish': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-fish.png?updatedAt=1754994598168',
                    'yellow-rock': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-rock.png?updatedAt=1754994599285',
                    'yellow-cup': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-cup.png?updatedAt=1754994597170',
                    'yellow-leaf': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-leaf.png?updatedAt=1754994597168',
                    'yellow-cloud': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-cloud.png?updatedAt=1754994596065',
                    'yellow-mushroom': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-mushroom.png?updatedAt=1754994599243',
                    'yellow-toiletpaper': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-toilerpaper.png?updatedAt=1754994600467',
                    
                    // Pink variants
                    'pink-cube': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-cube.png?updatedAt=1754994585656',
                    'pink-dice': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-dice.png?updatedAt=1754994585656',
                    'pink-banana': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-banana.png?updatedAt=1754994584395',
                    'pink-fish': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-fish.png?updatedAt=1754994586682',
                    'pink-rock': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-rock.png?updatedAt=1754994587813',
                    'pink-cup': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-cup.png?updatedAt=1754994585623',
                    'pink-leaf': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-leaf.png?updatedAt=1754994585656',
                    'pink-cloud': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-cloud.png?updatedAt=1754994584526',
                    'pink-mushroom': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-mushroom.png?updatedAt=1754994587798',
                    'pink-toiletpaper': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-toiletpaper.png?updatedAt=1754994588976',
                    
                    // Uncommon items
                    'red-bolt': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-bolt.png?updatedAt=1754994589865',
                    'blue-bolt': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-bolt.png?updatedAt=1754994572409',
                    'green-bolt': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-bolt.png?updatedAt=1754994578289',
                    'yellow-bolt': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-bolt.png?updatedAt=1754994595972',
                    'pink-bolt': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-bolt.png?updatedAt=1754994584446',
                    
                    'red-chip': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-chip.png?updatedAt=1754994589960',
                    'blue-chip': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-chip.png?updatedAt=1754994572419',
                    'green-chip': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-chip.png?updatedAt=1754994578118',
                    'yellow-chip': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-chip.png?updatedAt=1754994596045',
                    'pink-chip': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-chip.png?updatedAt=1754994584493',
                    
                    'red-lightbulb': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-lightbulb.png?updatedAt=1754994591998',
                    'blue-lightbulb': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-lightbulb.png?updatedAt=1754994575241',
                    'green-lightbulb': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-lightbulb.png?updatedAt=1754994580703',
                    'yellow-lightbulb': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-lightbulb.png?updatedAt=1754994598225',
                    'pink-lightbulb': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-lightbulb.png?updatedAt=1754994586751',
                    
                    'red-key': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-key.png?updatedAt=1754994591965',
                    'blue-key': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-key.png?updatedAt=1754994575209',
                    'green-key': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-key.png?updatedAt=1754994580665',
                    'yellow-key': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-key.png?updatedAt=1754994598259',
                    'pink-key': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-key.png?updatedAt=1754994586744',
                    
                    'red-star': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-star.png?updatedAt=1754994590917',
                    'blue-star': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-star.png?updatedAt=1754994577181',
                    'green-star': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-star.png?updatedAt=1754994583142',
                    'yellow-star': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-star.png?updatedAt=1754994600647',
                    'pink-star': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-star.png?updatedAt=1754994588930',
                    
                    'red-magnet': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-magnet.png?updatedAt=1754994593357',
                    'blue-magnet': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue0magnet.png?updatedAt=1754994577443',
                    'green-magnet': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-magnet.png?updatedAt=1754994581911',
                    'yellow-magnet': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-magnet.png?updatedAt=1754994599235',
                    'pink-magnet': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-magnet.png?updatedAt=1754994587712',
                    
                    // Rare items
                    'red-sword': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-sword.png?updatedAt=1754994594720',
                    'blue-sword': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-sword.png?updatedAt=1754994577176',
                    'green-sword': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-sword.png?updatedAt=1754994583194',
                    'yellow-sword': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-sword.png?updatedAt=1754994600358',
                    'pink-sword': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-sword.png?updatedAt=1754994589109',
                    
                    'red-controller': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-controller.png?updatedAt=1754994590894',
                    'blue-controller': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-%20controller.png?updatedAt=1754994572480',
                    'green-controller': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-controller.png?updatedAt=1754994579167',
                    'yellow-controller': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-controller.png?updatedAt=1754994597131',
                    'pink-controller': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-controller.png?updatedAt=1754994585610',
                    
                    'red-cookie': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-cookie.png?updatedAt=1754994590978',
                    'blue-cookie': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-cookie.png?updatedAt=1754994572441',
                    'green-cookie': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green%20cookie.png?updatedAt=1754994577975',
                    'yellow-cookie': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-cookie.png?updatedAt=1754994597151',
                    'pink-cookie': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-cookie.png?updatedAt=1754994585606',
                    
                    'red-pill': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-pill.png?updatedAt=1754994593379',
                    'blue-pill': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-pill.png?updatedAt=1754994575241',
                    'green-pill': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-pill.png?updatedAt=1754994581970',
                    'yellow-pill': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-pill.png?updatedAt=1754994599264',
                    'pink-pill': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-pill.png?updatedAt=1754994587860',
                    
                    // Epic items
                    'red-burger': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-burger.png?updatedAt=1754994589875',
                    'blue-burger': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-burger.png?updatedAt=1754994572423',
                    'green-burger': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-burger.png?updatedAt=1754994578253',
                    'yellow-burger': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-burger.png?updatedAt=1754994596020',
                    'pink-burger': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-burger.png?updatedAt=1754994584402',
                    
                    'red-flame': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-flame.png?updatedAt=1754994592241',
                    'blue-flame': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-flame.png?updatedAt=1754994575229',
                    'green-flame': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-flame.png?updatedAt=1754994580674',
                    'yellow-flame': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-flame.png?updatedAt=1754994598235',
                    'pink-flame': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-flame.png?updatedAt=1754994586764',
                    
                    'red-rifle': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-riffle.png?updatedAt=1754994593639',
                    'blue-rifle': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-riffle.png?updatedAt=1754994575459',
                    'green-rifle': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-riffle.png?updatedAt=1754994581978',
                    'yellow-rifle': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-riffle.png?updatedAt=1754994599329',
                    'pink-rifle': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-riffle.png?updatedAt=1754994587842',
                    
                    // Legendary items
                    'red-dragon': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-dragon.png?updatedAt=1754994590931',
                    'blue-dragon': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-dragon.png?updatedAt=1754994572438',
                    'green-dragon': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-dragon.png?updatedAt=1754994579235',
                    'yellow-dragon': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-dragon.png?updatedAt=1754994597148',
                    'pink-dragon': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-dragon.png?updatedAt=1754994585669',
                    
                    'red-rocket': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-rocket.png?updatedAt=1754994594662',
                    'blue-rocket': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-rocket.png?updatedAt=1754994575521',
                    'green-rocket': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-rocket.png?updatedAt=1754994583160',
                    'yellow-rocket': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-rocket.png?updatedAt=1754994600333',
                    'pink-rocket': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-rocket.png?updatedAt=1754994589070',
                    
                    // Mythic items
                    'red-trophy': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-trophy.png?updatedAt=1754994594689',
                    'blue-trophy': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-trophy.png?updatedAt=1754994577125',
                    'green-trophy': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-trophy.png?updatedAt=1754994583571',
                    'yellow-trophy': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-trophy.png?updatedAt=1754994600737',
                    'pink-trophy': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-trophy.png?updatedAt=1754994589286',
                    
                    'red-gem': 'https://ik.imagekit.io/8rb7srzl8/Downloads/red-gem.png?updatedAt=1754994592033',
                    'blue-gem': 'https://ik.imagekit.io/8rb7srzl8/Downloads/blue-gem.png?updatedAt=1754994575200',
                    'green-gem': 'https://ik.imagekit.io/8rb7srzl8/Downloads/green-gem.png?updatedAt=1754994580666',
                    'yellow-gem': 'https://ik.imagekit.io/8rb7srzl8/Downloads/yellow-gem.png?updatedAt=1754994598191',
                    'pink-gem': 'https://ik.imagekit.io/8rb7srzl8/Downloads/pink-gem.png?updatedAt=1754994586790',
                    
                    // Divine items (no color variants)
                    'solana-throne': 'https://ik.imagekit.io/8rb7srzl8/Downloads/solana-throne.png?updatedAt=1754994590917',
                    'solana-crown': 'https://ik.imagekit.io/8rb7srzl8/Downloads/solana-crown.png?updatedAt=1754994572417',
                    'solana-blade': 'https://ik.imagekit.io/8rb7srzl8/Downloads/solana-blade.png?updatedAt=1754994579208',
                    'solana-orb': 'https://ik.imagekit.io/8rb7srzl8/Downloads/solana-orb.png?updatedAt=1754994597168',
                    'solana-relic': 'https://ik.imagekit.io/8rb7srzl8/Downloads/solana-relic.png?updatedAt=1754994585656'
                };
                
                return allUrls[itemName] || null;
            }

            getImageFilename(itemName) {
                // Handle special case for green cookie with space
                if (itemName === 'green-cookie') {
                    return 'green cookie';
                }
                return itemName;
            }

            getRarityIcon(rarity) {
                const icons = {
                    common: '🥉',
                    uncommon: '🥈',
                    rare: '🥇',
                    epic: '💎',
                    legendary: '👑',
                    mythic: '⭐',
                    divine: '✨'
                };
                return icons[rarity] || '🎁';
            }



            generateRealisticAmount(rarity, pack) {
                const packMultipliers = {
                    'Silver Pack': 0.001,
                    'Gold Pack': 0.01,
                    'Diamond Pack': 0.1,
                    'Obsidian Pack': 1.0
                };

                const rarityMultipliers = {
                    common: [0.5, 2],
                    uncommon: [1, 5],
                    rare: [3, 15],
                    epic: [8, 40],
                    legendary: [20, 100],
                    mythic: [50, 250],
                    divine: [100, 500]
                };

                const packMultiplier = packMultipliers[pack] || 0.01;
                const [minMultiplier, maxMultiplier] = rarityMultipliers[rarity] || [1, 5];
                const randomMultiplier = minMultiplier + Math.random() * (maxMultiplier - minMultiplier);
                
                return parseFloat((packMultiplier * randomMultiplier).toFixed(4));
            }

            // Recent wins functionality removed

            updateStatsWithAnimation() {
                const packsElement = document.getElementById('packsOpened');
                const wonElement = document.getElementById('totalWon');
                
                if (packsElement) {
                    packsElement.classList.add('updating');
                    setTimeout(() => packsElement.classList.remove('updating'), 600);
                }
                
                if (wonElement) {
                    wonElement.classList.add('updating');
                    setTimeout(() => wonElement.classList.remove('updating'), 600);
                }
            }

            getPackDisplayName(packType) {
                const packNames = {
                    starter: 'Silver Pack',
                    pro: 'Gold Pack',
                    elite: 'Diamond Pack',
                    whale: 'Obsidian Pack'
                };
                return packNames[packType] || 'Pack';
            }

            getBestRarity(result) {
                // Get the highest rarity from the result
                if (result.cards && Array.isArray(result.cards)) {
                    const rarities = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'mythic', 'divine'];
                    let bestRarity = 'common';
                    
                    result.cards.forEach(card => {
                        const rarityIndex = rarities.indexOf(card.rarity);
                        const bestIndex = rarities.indexOf(bestRarity);
                        if (rarityIndex > bestIndex) {
                            bestRarity = card.rarity;
                        }
                    });
                    
                    return bestRarity;
                }
                
                return result.rarity || 'common';
            }
        }


        // Global functions
        let solCases;

        function connectWallet() {
            if (!solCases) {
                solCases = new SolCases();
            }
            solCases.connectWallet();
        }

        function openPack(packType) {
            if (!solCases) {
                solCases = new SolCases();
            }
            solCases.openPack(packType);
        }

        function sendMessage() {
            if (!solCases) {
                solCases = new SolCases();
            }
            solCases.sendMessage();
        }

        function setUsername() {
            if (!solCases) {
                solCases = new SolCases();
            }
            solCases.setUsername();
        }



        function toggleChat() {
            const chatSidebar = document.getElementById('chatSidebar');
            chatSidebar.classList.toggle('open');
        }

        // Deposit Modal Functions
        function showDepositModal() {
            const modal = document.getElementById('depositModal');
            const modalBalance = document.getElementById('modalBalance');
            const depositAddress = document.getElementById('depositAddress');
            
            modalBalance.textContent = solCases.balance.toFixed(4);
            
            // Set the deposit address to the user's current wallet
            if (solCases.currentWallet) {
                depositAddress.textContent = solCases.currentWallet;
            }
            
            modal.style.display = 'flex';
        }

        function closeDepositModal() {
            const modal = document.getElementById('depositModal');
            const transactionStatus = document.getElementById('transactionStatus');
            modal.style.display = 'none';
            transactionStatus.style.display = 'none';
            
            // Reset copy button
            const copyBtn = document.getElementById('copyBtn');
            copyBtn.textContent = '📋 Copy';
            copyBtn.classList.remove('copied');
        }

        async function copyDepositAddress() {
            const depositAddress = document.getElementById('depositAddress').textContent;
            const copyBtn = document.getElementById('copyBtn');
            
            try {
                await navigator.clipboard.writeText(depositAddress);
                copyBtn.textContent = '✅ Copied!';
                copyBtn.classList.add('copied');
                
                // Address copied to clipboard
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    copyBtn.textContent = '📋 Copy';
                    copyBtn.classList.remove('copied');
                }, 3000);
                
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = depositAddress;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                copyBtn.textContent = '✅ Copied!';
                copyBtn.classList.add('copied');
                // Address copied
                
                setTimeout(() => {
                    copyBtn.textContent = '📋 Copy';
                    copyBtn.classList.remove('copied');
                }, 3000);
            }
        }

        // For demo purposes, add a manual function to simulate receiving SOL
        function simulateDeposit() {
            const randomAmount = (Math.random() * 2 + 0.1).toFixed(4);
            solCases.balance += parseFloat(randomAmount);
            solCases.updateWalletUI();
                            // Demo: Received SOL
        }

        // Navigation Functions
        function showPacks() {
            // Scroll to packs section with header offset
            const packsSection = document.querySelector('.packs-grid');
            if (packsSection) {
                const headerHeight = document.querySelector('.header').offsetHeight;
                const elementPosition = packsSection.offsetTop - headerHeight - 20;
                window.scrollTo({ top: elementPosition, behavior: 'smooth' });
                setActiveButton(document.querySelector('.nav-btn[onclick="showPacks()"]'));
            }
        }

        function showInventory() {
            // Scroll to inventory section with header offset
            const inventorySection = document.querySelector('.inventory-section');
            if (inventorySection) {
                const headerHeight = document.querySelector('.header').offsetHeight;
                const elementPosition = inventorySection.offsetTop - headerHeight - 20;
                window.scrollTo({ top: elementPosition, behavior: 'smooth' });
                setActiveButton(document.querySelector('.nav-btn[onclick="showInventory()"]'));
            }
        }





        // Update active navigation button based on scroll position
        function updateActiveNavButton() {
            const headerHeight = document.querySelector('.header').offsetHeight;
            const scrollPosition = window.scrollY + headerHeight + 50; // Reduced buffer
            
            const sections = [
                { element: document.querySelector('.packs-grid'), button: document.querySelector('.nav-btn[onclick="showPacks()"]') },
                { element: document.querySelector('.inventory-section'), button: document.querySelector('.nav-btn[onclick="showInventory()"]') }
            ];
            
            // Remove active class from all buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Find which section is currently in view
            let activeSectionFound = false;
            for (let i = sections.length - 1; i >= 0; i--) {
                const section = sections[i];
                if (section.element && section.button) {
                    const sectionTop = section.element.offsetTop;
                    const sectionBottom = sectionTop + section.element.offsetHeight;
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                        section.button.classList.add('active');
                        activeSectionFound = true;
                        break;
                    }
                }
            }
            
            // If no section is found, default to Packs
            if (!activeSectionFound) {
                document.querySelector('.nav-btn[onclick="showPacks()"]').classList.add('active');
            }
        }

        // Also update active button when clicking navigation buttons
        function setActiveButton(buttonElement) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            buttonElement.classList.add('active');
        }

        // Add scroll event listener
        window.addEventListener('scroll', updateActiveNavButton);

        function showAffiliate() {
            // Show affiliate modal or section (placeholder for now)
                            // Affiliate system coming soon
        }

        // Withdraw Functions
        function requestWithdraw() {
            if (!solCases.currentWallet || !solCases.balance) {
                alert('Please connect your wallet first');
                return;
            }

            showWithdrawModal();
        }

        function showWithdrawModal() {
            const modal = document.getElementById('withdrawModal');
            const withdrawBalance = document.getElementById('withdrawBalance');
            const withdrawAddressInput = document.getElementById('withdrawAddressInput');
            const withdrawAmount = document.getElementById('withdrawAmount');
            
            // Set current balance
            withdrawBalance.textContent = solCases.balance.toFixed(4);
            
            // Clear address input
            withdrawAddressInput.value = '';
            
            // Set default amount to full balance
            withdrawAmount.value = solCases.balance.toFixed(4);
            
            modal.style.display = 'flex';
        }

        function closeWithdrawModal() {
            const modal = document.getElementById('withdrawModal');
            modal.style.display = 'none';
        }



        function setWithdrawAmount(percentage) {
            const withdrawAmount = document.getElementById('withdrawAmount');
            const amount = solCases.balance * percentage;
            withdrawAmount.value = amount.toFixed(4);
        }

        async function pasteAddress() {
            try {
                const text = await navigator.clipboard.readText();
                const addressInput = document.getElementById('withdrawAddressInput');
                addressInput.value = text.trim();
            } catch (error) {
                solCases.showNotification('Failed to paste from clipboard. Please paste manually.', 'error');
            }
        }

        async function confirmWithdraw() {
            const withdrawAmount = document.getElementById('withdrawAmount');
            const withdrawAddressInput = document.getElementById('withdrawAddressInput');
            const confirmBtn = document.getElementById('confirmWithdrawBtn');
            const amount = parseFloat(withdrawAmount.value);
            const address = withdrawAddressInput.value.trim();

            // Validate amount
            if (!amount || amount <= 0) {
                solCases.showNotification('Please enter a valid amount', 'error');
                return;
            }

            if (amount > solCases.balance) {
                solCases.showNotification('Amount cannot exceed your balance', 'error');
                return;
            }

            // Validate SOL address
            if (!address) {
                solCases.showNotification('Please enter your SOL wallet address', 'error');
                return;
            }

            // Basic SOL address validation (44 characters, starts with common prefixes)
            if (address.length !== 44 || !address.match(/^[1-9A-HJ-NP-Za-km-z]{44}$/)) {
                solCases.showNotification('Please enter a valid SOL wallet address', 'error');
                return;
            }

            // Disable button and show loading
            confirmBtn.disabled = true;
            confirmBtn.textContent = '⏳ Processing...';

            try {
                // Get session ID from localStorage
                const sessionId = localStorage.getItem('privy-session-id');
                
                const response = await fetch('https://solcases.fun/api/withdraw', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId || ''
                    },
                    body: JSON.stringify({ 
                        amount: amount,
                        address: address
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Update local balance
                    solCases.balance = data.newBalance;
                    solCases.updateWalletUI();
                    
                    solCases.showNotification(`⚡ Instant withdrawal completed! ${amount.toFixed(4)} SOL sent to ${address.substring(0, 8)}...${address.substring(address.length - 8)}`, 'success');
                    closeWithdrawModal();
                } else {
                    solCases.showNotification(data.message || 'Failed to process withdrawal request.', 'error');
                }
            } catch (error) {
                console.error('Error processing withdrawal:', error);
                solCases.showNotification('Failed to process withdrawal request. Please try again.', 'error');
            } finally {
                // Re-enable button
                confirmBtn.disabled = false;
                confirmBtn.textContent = '💸 Request Withdrawal';
            }
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const depositModal = document.getElementById('depositModal');
            const withdrawModal = document.getElementById('withdrawModal');
            
            if (depositModal) {
                depositModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeDepositModal();
                    }
                });
            }
            
            if (withdrawModal) {
                withdrawModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeWithdrawModal();
                    }
                });
            }
        });

        // Initialize on page load
        window.onload = () => {
            solCases = new SolCases();
        };

        // Tooltip Functions
        let currentPackType = null;
        let cardsMode = false;

        function showPackTooltip(event, packType) {
            const tooltip = document.getElementById('tooltip');
            const packData = getPackData(packType);
            currentPackType = packType;
            
            tooltip.innerHTML = `
                <div class="tooltip-title">${packData.name} Details</div>
                <div class="tooltip-odds">
                    ${packData.odds.map(odd => `
                        <div class="tooltip-odds-item">
                            <div class="tooltip-odds-header" ${cardsMode ? `onclick="toggleRarityCards('${packType}', '${odd.rarity}')"` : ''}>
                                <div class="rarity-info">
                                    <span class="rarity ${odd.rarity}">${odd.rarity.charAt(0).toUpperCase() + odd.rarity.slice(1)}</span>
                                    <span class="rarity-percentage">${odd.probability}%</span>
                                </div>
                                <div class="rarity-range" style="font-size: 11px; color: var(--text-secondary); margin-top: 2px;">
                                    Range: ${odd.range ? `${odd.range[0]} - ${odd.range[1]}` : 'N/A'}
                                </div>
                                ${cardsMode ? '<span class="expand-icon">▼</span>' : ''}
                            </div>
                            ${cardsMode ? `
                                <div class="tooltip-rarity-cards hidden" id="cards-${packType}-${odd.rarity}">
                                    <div class="tooltip-cards-grid">
                                        ${getCardsForRarity(packType, odd.rarity).map(card => `
                                            <div class="tooltip-card">
                                                <div class="tooltip-card-icon">${card.icon}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Position tooltip
            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = rect.right + 10 + 'px';
            tooltip.style.top = rect.top + 'px';
            
            tooltip.classList.add('show');
            if (cardsMode) {
                tooltip.classList.add('cards-mode');
            } else {
                tooltip.classList.remove('cards-mode');
            }
        }

        function hideTooltip() {
            // Only hide tooltip if not in cards mode
            if (!cardsMode) {
                const tooltip = document.getElementById('tooltip');
                tooltip.classList.remove('show');
                tooltip.classList.remove('cards-mode');
            }
        }

        function closeTooltip() {
            // Unconditionally close tooltip (for scroll and click-outside)
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('show');
            tooltip.classList.remove('cards-mode');
            cardsMode = false; // Reset cards mode
        }

        function toggleRarityCards(packType, rarity) {
            const cardsSection = document.getElementById(`cards-${packType}-${rarity}`);
            const header = cardsSection.previousElementSibling;
            const expandIcon = header.querySelector('.expand-icon');
            
            if (cardsSection.classList.contains('hidden')) {
                // Show cards
                cardsSection.classList.remove('hidden');
                header.classList.add('expanded');
                expandIcon.textContent = '▲';
            } else {
                // Hide cards
                cardsSection.classList.add('hidden');
                header.classList.remove('expanded');
                expandIcon.textContent = '▼';
            }
        }



        function toggleCardsMode(packType) {
            cardsMode = !cardsMode;
            if (currentPackType === packType) {
                // Refresh the tooltip with new mode
                const tooltip = document.getElementById('tooltip');
                if (tooltip.classList.contains('show')) {
                    showPackTooltip({ target: document.querySelector(`[onclick*="${packType}"]`) }, packType);
                }
            }
        }

        function getCardsForRarity(packType, rarity) {
            const cardsByRarity = {
                common: [
                    { icon: '🪙' },
                    { icon: '🪙' },
                    { icon: '🪙' }
                ],
                uncommon: [
                    { icon: '🪙' },
                    { icon: '🪙' },
                    { icon: '🪙' }
                ],
                rare: [
                    { icon: '🏅' },
                    { icon: '🥈' },
                    { icon: '🥈' }
                ],
                epic: [
                    { icon: '👑' },
                    { icon: '💎' },
                    { icon: '💎' }
                ],
                legendary: [
                    { icon: '👑' },
                    { icon: '💎' },
                    { icon: '💎' }
                ],
                mythic: [
                    { icon: '👑' },
                    { icon: '⭐' },
                    { icon: '🌙' }
                ],
                divine: [
                    { icon: '👑' },
                    { icon: '⭐' },
                    { icon: '✨' }
                ]
            };
            
            return cardsByRarity[rarity] || cardsByRarity.common;
        }

        function getPackData(packType) {
            const packData = {
                starter: {
                    name: 'Silver Pack',
                    odds: [
                        { rarity: 'common', probability: 58, range: [1, 5800] },
                        { rarity: 'uncommon', probability: 39, range: [5801, 9700] },
                        { rarity: 'rare', probability: 2, range: [9701, 9900] },
                        { rarity: 'epic', probability: 0.45, range: [9901, 9945] },
                        { rarity: 'legendary', probability: 0.05, range: [9946, 9950] }
                    ]
                },
                pro: {
                    name: 'Gold Pack',
                    odds: [
                        { rarity: 'uncommon', probability: 70, range: [1, 7000] },
                        { rarity: 'rare', probability: 25, range: [7001, 9500] },
                        { rarity: 'epic', probability: 4.70, range: [9501, 9970] },
                        { rarity: 'legendary', probability: 0.25, range: [9971, 9995] },
                        { rarity: 'mythic', probability: 0.05, range: [9996, 10000] }
                    ]
                },
                elite: {
                    name: 'Diamond Pack',
                    odds: [
                        { rarity: 'rare', probability: 62, range: [1, 6200] },
                        { rarity: 'epic', probability: 33, range: [6201, 9500] },
                        { rarity: 'legendary', probability: 4, range: [9501, 9900] },
                        { rarity: 'mythic', probability: 0.95, range: [9901, 9995] },
                        { rarity: 'divine', probability: 0.05, range: [9996, 10000] }
                    ]
                },
                whale: {
                    name: 'Obsidian Pack',
                    odds: [
                        { rarity: 'epic', probability: 60, range: [1, 6000] },
                        { rarity: 'legendary', probability: 32, range: [6001, 9200] },
                        { rarity: 'mythic', probability: 6, range: [9201, 9800] },
                        { rarity: 'divine', probability: 2, range: [9801, 10000] }
                    ]
                }
            };
            
            return packData[packType] || packData.starter;
        }

        // Add scroll event listener to close tooltip
        document.addEventListener('scroll', function() {
            closeTooltip();
        });

        // Add click outside tooltip to close when in cards mode
        document.addEventListener('click', function(event) {
            const tooltip = document.getElementById('tooltip');
            const infoIcons = document.querySelectorAll('.pack-info-icon');
            let clickedOnIcon = false;
            
            infoIcons.forEach(icon => {
                if (icon.contains(event.target)) {
                    clickedOnIcon = true;
                }
            });
            
            if (!tooltip.contains(event.target) && !clickedOnIcon && tooltip.classList.contains('show') && cardsMode) {
                closeTooltip();
            }
        });

        // Initialize the app
        // this.init(); // Removed - no init method exists
    </script>
</body>
</html>
